
<style>
    .openGiftKartModal {
        vertical-align: middle;
    }

    #other {
        text-align: right;
        width: 100%;
        max-width: 100%;
    }

    .header__inline h1,
    .header__inline h2,
    .header__inline h3,
    .header__inline h4,
    .header__inline h5,
    .header__inline h6,
    .header__inline p {
        display: inline;
    }


    .GiftKartModalbtn:hover,
    .gktModalSave:hover {
        transform: scale(0.95);
    }


    .GiftKartContainer {
        display: none;
        width: 100%;
        height: 100vh;
        position: fixed;
        opacity: 1;
        background: #222;
        z-index: 999999999;
        top: 0;
        left: 0;
        overflow: hidden;
        animation-name: fadeIn_Container;
        animation-duration: 1s
    }

    .GiftKartModal {
        display: none;
        top: 0;
        min-width: 250px;
        width: 50vw !important;
        margin: 0 auto;
        margin-top: 25vh !important;
        z-index: 9999999999;
        background: #fff;
        box-shadow: 0 0 10px #000;
        animation-name: fadeIn_Modal;
        animation-duration: .8s;
    }

    .GiftKartheader {
        padding: 5px 10px;
        width: 100%;
        height: 70px;
        border-radius: 10px 10px 0 0;
        border-bottom: 2px solid #ccc
    }

    .GiftKartheader a {
        text-decoration: none;
        float: right;
        line-height: 70px;
        margin-right: 20px;
        color: #aaa
    }

    .GiftKartcontent {
        width: 100%;
    }

    #first_label {
        padding-top: 30px
    }

    #second_label {
        padding-top: 25px
    }

    .GiftKartfooter,
    .gktModalFooter {
        padding: 13px 10px;
        text-align: right;
        width: 100%;

    }




    @media screen and (max-width: 900px) {
        .GiftKartModalContent-left {
            display: none;
        }

        .GiftKartModalContent {
            grid-template-columns: 1fr !important;
        }

        .GiftKartModalContent-right-giftingOptions {
            font-size: 15px !important;
        }
    }

    @keyframes fadeIn_Modal {
        from {
            opacity: 0
        }

        to {
            opacity: 1
        }
    }

    @keyframes fadeIn_Container {
        from {
            opacity: 0
        }

        to {
            opacity: .9
        }
    }

    #is-a-gift {
        margin: 0px;
        padding: 10px;
    }

    #giftnote,
    .gktMessageTextarea {
        color: #636363;
        border: 1px solid #ccc;
        width: 100%;
        border-radius: 5px;
        height: 200px;
        padding: 10px;
        margin-top: 5px;
        resize: none;
        font-size: 14px !important;
    }

    .giftnote-giftKart {
        border: 1px solid black !important;
        border-radius: 0px !important;
    }

    .giftnote-giftKart:focus {
        outline: 0;
    }

    .GiftKartModalContent {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1;
        font-family: 'Helvetica', 'Arial', sans-serif;
    }

    .GiftKartModalContent-right {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: 30px 50px;
    }

    .GiftKartModalContent-right-closeButton,
    .gktModalClose {
        fill: rgba(255, 255, 255, 0.851);
        background: rgba(32, 33, 36, 0.1);
        -webkit-border-radius: 50%;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        padding: 1px;
        align-self: baseline;
        justify-self: end;
        margin-top: 3px;
        margin-right: 3px;
        cursor: pointer;
    }

    .GiftKartModalContent-right-header {
        align-self: center;
        justify-self: center;
        font-weight: 1000;
    }

    .GiftKartModalContent-right-giftingOptions {
        font-size: 20px;
        padding: 10px;
    }

    .GiftKartModalContent-right-footer {
        margin: 15px 20px;
        display: grid;
        align-items: center;
    }

    .GiftKartModalbtn,
    .gktModalSave {
        cursor: pointer;
        padding: 6px 12px;
        font-weight: 500;
        text-align: center;
        background-color: #A96668;
        color: white;
        transition: transform .2s;
        margin: 0 20%;
    }

    .ql-size-small {
        font-size: 11px;
    }

    .ql-size-large {
        font-size: 26px;
    }

    .ql-size-huge {
        font-size: 36px;
    }

    .gktModalWrapper {

        display: none;
        width: 100%;
        height: 100vh;
        position: fixed;
        opacity: 1;
        background: #222;
        z-index: 999999999;
        top: 0;
        left: 0;
        overflow: hidden;
        animation-name: fadeIn_Container;
        animation-duration: 1s
    }

    /* Modal Content */
    .gktModal {

        position: fixed;
        top: 25%;
        left: 50%;
        min-width: 250px;
        width: 50vw !important;
        margin: 10px auto;
        padding: 10px;
        margin-top: 25vh !important;
        border-radius: 2%;
        background: #fefefe;
        box-shadow: 0 0 10px #000;
        animation-name: fadeIn_Modal;
        animation-duration: .8s;

        transform: translate(-50%, -50%);
    }




    .gktModalClose:hover,
    .gktModalClose:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }



    .gktPageWrapper {
        display: grid;
        grid-template-columns: 1fr;
        cursor: pointer !important;
        /* padding: 0px 10px; */
    }


    .gktPageWrapperV2 {
        display: grid;
        grid-template-columns: 1fr;
        cursor: pointer !important;
      
    }

    .gktProductPageUpsellWrapper {
        display: none;
        width: 100%
    }

    .gktComboWrapper {
        display: none;
        ,
        width: 100%
    }

    .gktGiftMessageWrapper {
        display: none;
        width: 100%
    }

    .gktGiftMsgAndWrapWrapper {
        display: none;
        width: 100%
    }


    .gktCartUpsellWrapper {
        display: none;
        width: 100%
    }



    .gktCartGiftMessageWrapper {
        display: none;
        width: 100%
    }

    .gktCartGiftMsgAndWrapWrapper {
        display: none;
        width: 100%
    }

    .gktGiftMessageWrapper {
        display: none;
        width: 100%
    }

    .gktCartGiftMessageWrapper {
        display: none;
        width: 100%
    }


    .gktPageWrapper input {
        display: inline-block;
    }

    .gktPageWrapper label {
        margin-left: 1px;
    }

    .giftCartPageWrapper {
        display: grid;
        grid-template-columns: 25px 4fr;
        align-items: baseline;
        justify-items: start;
    }



    .gktModalHeader {
        padding: 10px;
    }

    .gktContentWrapper {
        display: grid;
    }

    .gktGridLayout {
        /* is attached dynamically to gktContentWrapper*/
        grid-template-columns: 1fr 1fr;
    }

    /*.gktLeftContent and gktRightContent */
    .gktContentWrapper>div {
        display: grid;
        grid-template-rows: 1fr 3fr;
        grid-gap: 10px;
        padding: 5px 10px;
        margin: 5px 10px;
        font-size: 30px;
    }

    .gktContentWrapper>div:empty {
        display: none;
    }

    .gktMessageCheckboxHeading,
    .gktWrapCheckboxHeading {
        font-size: 20px !important;
    }

    .gktModalFooter {
        text-align: center;
    }



    /* Header should be in one line*/
    .gktModalHeader {
        display: grid;
        grid-template-columns: auto 25px;
    }


    .gktProductPageWrapper {
        position: relative;
        justify-items: start;
        align-items: end;
    }

    .gktJustifyCenter {
        justify-self: center;
        align-self: center;
    }

    .gktGiftWrapImage {
        width: 200px;
        height: 200px;
        background-repeat: no-repeat;
        background-position: 50% 50%;
        justify-self: center;
        object-fit: cover;
    }


    .gktCartGiftMsgAndWrapHeader {
        display: grid;
        justify-items: left;
        padding: 3px 0px;
        margin: 3px 0px;

    }

    .gktGiftMsgAndWrapHeader {
        display: grid;
        justify-items: left;
        padding: 3px 0px;
        margin: 3px 0px;
    }

    .gktGiftMsgAndWrapWrapperInnerEle {
        display: grid !important;
        grid-template-columns: 25px auto;
        align-items: center;
        justify-items: center;
        user-select: none;
    }

    .gktGiftMsgAndWrapWrapperInnerEle p {
        margin: 0 !important;
        padding: 0 !important;
    }


    .gktGiftMsgAndWrapHeader>label {
        margin: 0 !important;
        padding: 0 !important;
    }

    .gktCartGiftMsgAndWrapHeader>label {
        margin: 0 !important;
        padding: 0 !important;
    }

    .gift-checkbox-giftKart {
        align-self: center;
        justify-self: center;
    }

    .gktCheckboxLayout {
        display: grid !important;
        grid-template-columns: 25px auto;
        font-size: 20px;
        align-items: center;
    }

    .gktMessageCheckboxHeading>p,
    .gktModalPopupHeading>p,
    .gktGiftWrapCheckboxHeading>p {
        margin: 0 !important;
    }

    .gktAlignCenter {
        align-self: center;
    }

    @media screen and (max-width: 900px) {
        .gktGridLayout {
            grid-template-columns: 1fr;
        }

        .gktContentWrapper>div {
            grid-template-rows: 1fr !important;
        }

        .gktLeftContent {
            grid-template-rows: 1fr 1fr !important;
        }

        .gktMessageTextarea {
            width: 100% !important;
            height: 100px !important;
        }

        .gktModal {
            top: 10% !important;

        }

        .gktDisplayWrapImageOnPhone {
            display: block !important;
        }

        .gktModal {
            width: 95vw !important;
        }

        .gktModalWrapper p,
        .gktModal p {
            font-size: 20px !important;
        }

    }

    .ql-font-arial {
        font-family: 'Arial';
    }

    .ql-font-times-new-roman {
        font-family: 'Times New Roman';
    }

    .ql-font-courier-new {
        font-family: 'Courier New';
    }

    .ql-font-comic-sans-ms {
        font-family: 'Comic Sans MS';
    }

    .ql-font-impact {
        font-family: 'Impact';
    }

    .ql-font-lucida-console {
        font-family: 'Lucida Console';
    }

    .ql-font-lucida-sans-unicode {
        font-family: 'Lucida Sans Unicode';
    }

    .ql-font-tahoma {
        font-family: 'Tahoma';
    }

    .ql-font-verdana {
        font-family: 'Verdana';
    }

    .ql-font-helvetica {
        font-family: 'Helvetica';
    }

    .ql-font-trebuchet-ms {
        font-family: 'Trebuchet MS';
    }

    .ql-font-georgia {
        font-family: 'Georgia';
    }

    .ql-font-garamond {
        font-family: 'Garamond';
    }

    .ql-font-brush-script-mt {
        font-family: 'Brush Script MT';
    }

    .loadingCheckoutPage{
        display:flex;
        align-items:center;
        justify-content: center;
        opacity:0.5;
        }
</style>
<style>

.gktComboContainer {
   display:  grid;
   grid-template-columns: 1fr;
   grid-template-rows: auto;

}
.gktPrevImage,.gktNextImage{
    margin-left:5px;
    font-size: 16px;
}
.gktComboSliderNavigatior{
    position: absolute;
    bottom: 5px;
    right:5px;
}
.gktComboItemContainer{
    display:  grid;
    grid-template-columns: 1fr 2fr;
    grid-template-rows: auto;
    padding: 3px 0px;
    margin: 3px 0px;
    border-radius: 3px;
    border: 1px solid #f1f2f3;
}

.gktComboItemContainerItem1{
    grid-row: 1 / 5;
    position:relative;
}

.gktComboItemContainerItem2{
    padding-left: 5px;
    text-align: left;
}

.gktComboItemContainerItem3{
    padding-left: 5px;
    text-align: left;
}

.gktComboItemContainerItem4{
    padding-left: 5px;
    text-align: left;
}


.gktComboItemContainerItem3CustomSelect{
    position: relative;
    width: fit-content;
  
}

.gktComboItemContainerItem3CustomSelect > select{
    box-shadow: 0;
    font-size: 16px;
    padding: 6px 10px;
    background-color: #fafafa;
    border: 1px solid #eee;
    min-width: 120px;
    margin: 0px;
    
}

.gktComboItemContainerItem3CustomSelect > select:focus{
    outline:none;

}

.gktComboItemContainerItem3CustomSelect > .gktComboItemContainerItem3SelectDropdownBtn {
    position: absolute;
    display: block;
    top:0;
    right: 0;
    background: #fafafa;
    height: 100%;
    width: 20px;
    pointer-events: none;

}
.gktComboItemContainerItem3CustomSelect > .gktComboItemContainerItem3SelectDropdownBtn::before,
.gktComboItemContainerItem3CustomSelect > .gktComboItemContainerItem3SelectDropdownBtn::after
 {
    content: "";
    position: absolute;
    width: 0;
    height: 0;
    left: 50%;
    transform: translate(-50%, -50%);

}

.gktComboItemContainerItem3CustomSelect > .gktComboItemContainerItem3SelectDropdownBtn::before
 {
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid #635959;
    top:30%

}

.gktComboItemContainerItem3CustomSelect > .gktComboItemContainerItem3SelectDropdownBtn::after
 {
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #635959;
    top: 70%;
}



.gktComboModalWrapper {
   
   display: none;
   width: 100%;
   height: 100vh;
   position: fixed;
   opacity: 1;
   background: #222;
   z-index: 999999999;
   top: 0;
   left: 0;
   overflow: hidden;
   animation-name: fadeIn_Container;
   animation-duration: .2s
}

 /* Modal Content */
.gktComboModal {
   
   position: fixed;
   top: 25%;
   left: 50%;
   min-width: 250px;
   width: 50vw !important;
   margin: 10px auto;
   padding:10px;
   margin-top: 25vh !important;
   border-radius: 4px;
   background: #fefefe;
   box-shadow: 0 0 10px #000;
   animation-name: fadeIn_Modal;
   animation-duration: .2s;

   transform: translate(-50%, -50%);
 }
 
 

/* Header should be in one line*/
.gktComboModalHeader {
    display: grid;
    grid-template-columns: auto 25px;
}


.gktComboModalPopupHeading > p {
    margin: 0 !important;
}

.gktComboModalClose{
    fill: rgba(255,255,255,0.851);
    background: rgba(32,33,36,0.4);
    -webkit-border-radius: 50%;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    padding: 1px;
    align-self: baseline;
    justify-self: end;
    margin-top: 3px;
    margin-right: 3px;
    cursor: pointer;
}

  
.gktComboModalClose:hover,
  .gktComboModalClose:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }


.gktComboContent {
    display:grid;
    grid-template-rows: 1fr 3fr;
    grid-gap: 10px;
    padding: 5px 10px;
    margin:5px 10px;
    font-size: 30px;
}

.gktComboContentHeader{

}
.gktComboContentFooter{

}
.gktComboContentFooterBtn1{

}
.gktComboContentFooterBtn2{

}

</style>
<style>

.gktOneClickUpsellContainer {
   display:  grid;
   grid-template-columns: 1fr;
   grid-template-rows: auto;
   padding: 5px 0px;
}

.gktOneClickUpsellItemContainer{
    display:  grid;
    grid-template-columns: 1fr;
    grid-template-rows: auto;
    padding: 3px 0px;
    margin: 3px 0px;
    border-radius: 3px;
    font-size: 14px;
}

.gktOneClickUpsellItemContainer label {
  margin-bottom: 0px
}

.gktOneClickUpsellItemContainerLabelText{
  align-self: center;
  font-size:12px;
  justify-self: left;
  text-align: left;
}
.gktOneClickUpsellImage{
   width: 40px;
    height: 40px;
    border: 1px solid #f1f2f3;
}
.gktOneClickUpsellItemContainerItem1{
    grid-row: 1 / 5;
}

.gktOneClickUpsellItemContainerItem2{
    
}

.gktOneClickUpsellItemContainerItem3{
    position: relative;
    display: flex;
    width: fit-content;
    height: 30px;
    border-radius: 4px;
    overflow: hidden;
}

 label.gktCustomCheckboxContainer {
    display: grid;
    grid-template-columns: 5fr 1fr;
} 

/* The container */
.gktCustomCheckboxContainer {
  display: block;
  position: relative;
  padding-left: 35px;
 
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default checkbox */
.gktCustomCheckboxContainer input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

/* Create a custom checkbox */
.gktCustomCheckboxCheckmark {
  position: absolute;
  top: 5px;
  left: 0;
  height: 25px;
  width: 25px;
  border: 1px solid #a2a2a2;
  border-radius: 4px;
}

/* On mouse-over, add a grey background color */
.gktCustomCheckboxContainer:hover input ~ .gktCustomCheckboxCheckmark {
  background-color: #ccc;
}

/* When the checkbox is checked, add a blue background 
.gktCustomCheckboxContainer input:checked ~ .gktCustomCheckboxCheckmark {
  background-color: #2196F3;
} */

/* Create the gktCustomCheckboxCheckmark/indicator (hidden when not checked) */
.gktCustomCheckboxCheckmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the gktCustomCheckboxCheckmark when checked */
.gktCustomCheckboxContainer input:checked ~ .gktCustomCheckboxCheckmark:after {
  display: block;
}

/* Style the gktCustomCheckboxCheckmark/indicator */
.gktCustomCheckboxContainer .gktCustomCheckboxCheckmark:after {
  left: 8px;
  top: 1px;
  width: 8px;
  height: 16px;
  border: solid #009c00;
  border-width: 0 3px 3px 0;
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  transform: rotate(45deg);
}

</style>
<style>

.gktGiftCardModalWrapper {
   
    display: none;
    width: 100%;
    height: 100vh;
    position: fixed;
    opacity: 1;
    background: #222;
    z-index: 999999999;
    top: 0;
    left: 0;
    overflow: hidden;
    animation-name: fadeIn_Container;
    animation-duration: .2s
 }
 
  /* Modal Content */
 .gktGiftCardModal {
    position: fixed;
    top: 25%;
    left: 50%;
    max-width: 600px;
    width: 45vw !important;
    margin: 10px auto;
    padding:10px;
    margin-top: 20vh !important;
    border-radius: 4px;
    background: #fefefe;
    box-shadow: 0 0 10px #000;
    animation-name: fadeIn_Modal;
    animation-duration: .2s;
    transform: translate(-50%, -50%);
    line-height: 16px;
    max-height: 90vh;
    overflow-y: auto;
    overflow-x: hidden;
    color: black !important;
  }
  
.gktGiftCardInputFieldsDiv{
    display: grid;
}
 
 /* Header should be in one line*/
 .gktGiftCardModalHeader {
     display: grid;
     grid-template-columns: auto 25px;
 }
 
 
 .gktGiftCardModalPopupHeading > p {
     margin: 0 !important;
 }
 .gktGiftCardModalPopupHeading{
     font-size: 20px;
     
 }
 .gktGiftCardModalClose{
     fill: rgba(255,255,255,0.851);
     background: rgba(32,33,36,0.4);
     -webkit-border-radius: 50%;
     border-radius: 50%;
     width: 24px;
     height: 24px;
     padding: 1px;
     align-self: baseline;
     justify-self: end;
     margin-top: 3px;
     margin-right: 3px;
     cursor: pointer;
 }
 
   
 .gktGiftCardModalClose:hover,
   .gktGiftCardModalClose:focus {
     color: #000;
     text-decoration: none;
     cursor: pointer;
   }
 .gktGiftCardInputFieldsDiv > div {
     display: grid;
     padding-bottom:10px;
 }

 .gktGiftCardInputFieldsDiv  label{
        line-height: 1.2;
        margin-bottom:0px;
        font-size: 14px;
        color:black !important;
 }


 .gktGiftCardDetailsContent .gktGiftCardGreetingCardContent{
     height: 450px;
 }

 .gktGiftCardContainer{
     height:450px;
 }

 .gktGiftCardDetailsContent input{
    margin:0px;
    padding: 10px 18px;
    width: 100%;
    border: 1px solid #cccccc;
    background-color: #ffffff;
    color: #000000;
    max-width: 100%;
    line-height: 1.2;
    border-radius: 2px;
    padding-bottom: 10px;
    font-size:14px !important;
 }

 .gktGiftCardDetailsContent textarea {
    margin:0px;
    padding: 10px 18px;
    width: 100%;
    border: 1px solid #cccccc;
    background-color: #ffffff;
    color: #000000;
    max-width: 100%;
    line-height: 1.2;
    border-radius: 2px;
    padding-bottom: 10px;
    max-height: 100px !important;
    min-height:50px !important;
    font-size:14px !important;
 }



 .gktGiftCardDetailsContent{
     font-size: 16px;
 }
//  .gktGiftCardModalSubText{
//     padding:10px;
//  }
 .old-code{
     .gktGiftCardDetailsContent{
        display:grid;
        grid-template-rows: 1fr 1fr;
        grid-gap: 10px;
     }
     .gktGiftCardContentFooterBtn1{
        margin: 0 20%;  
     }
 }
 .gktGiftCardDetailsContent {
     padding: 5px;
     margin:5px 10px;
     font-size: 30px;
 }
 .gktGiftCardEmailValidation,.gktGiftCardDateValidation{
    color: red;
    margin: 0;
    padding: 0;
    font-size: 12px;
 }
  .gktGiftCardInputFieldsDiv label[required]::after, label[required]:after{
    content: '*';
    margin-right: 4px;
    color: red;
  }
 
 .gktGiftCardContentHeader{
 
 }
 .gktGiftCardContentFooter{
    margin: 10px auto;
 }
 .gktGiftCardContentFooterBtn1{
    cursor: pointer;
    padding: 6px 12px;
    font-weight: 500;
    text-align: center;
    background-color: #A96668;
    color: white;
    transition: transform .2s;
    font-size:16px; 
 }
 .gktGiftCardContentFooterBtn1:hover {
    transform: scale(0.95);
}
 .gktGiftCardContentFooterBtn2{
 
 }
 @media screen and (max-width: 900px) {
    .gktGiftCardModal {
        top: 25%;
        left: 50%;
        min-width: 250px;
        width: 90vw !important;
        margin: 10px auto;
        padding:10px;
        margin-top: 22vh !important;
    }
 }


.greetingCardMainBody{
    display:grid;
    grid-template-columns: 1fr;
}

.greetingCardCategoryListItemText{
    text-align: center;
    line-height: 30px;
    width: 100%;
    display: block;
    text-decoration: none;
    color: #008060;
    text-transform: capitalize;
    font-size: 16px;
}

.greetingCardImageList .greetingCardImageLabel{
}
// css class for the checked image
.greetingCardImageList .greetingCardLabel input:checked{
    border:2px solid #A96668;
    border-radius:5px;
}

.greetingCardImagePreview{
    width:100%;
    align-self:center;
    display:none;
}
.activeGreetingCardCategory a, .greetingCardCategoryListItem a:hover {
    background-color: black;
    color:white !important;
    border-radius:5px;
    cursor:pointer;
}

.greetingCardImage:hover{
    transform: scale(1.05);
    transition: transform .3s;
    border-radius:5px;
}

OLD .greetingCardCategoryListItem{
    display:inline-block;
    font-size:16px;
    text-transform:capitalize;
    text-transform:uppercase;
    padding-right:10px;
}

.greetingCardCategoryList{
    text-align: left;
    list-style: none;
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    padding: 0;
    margin: 0 0 15px;
}

.greetingCardCategoryListItem{
    display: inline-block;
    text-align: center;
    height: auto;
    line-height: 2em;
    padding: 0;
    margin: 0;
}

.activeGreetingCard{
    border:2px solid #A96668;  
    border-radius:5px;  
}

.greetingCardImageInput{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    visibility:hidden;
}

.greetingCardImageList{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    overflow-x: hidden;
    overflow-y: auto;
    padding-right:5px;
    height:350px;
}



.greetingCardImageList .greetingCardImageLabel img{
    max-width:100%;
    padding:10px;
}

.greetingCardImageLabel{
    position:relative;
    cursor:pointer;
    display:inline-block;
    width:100%;
    align-self:center;

}

.gktGiftCardSendNowButton, .gktGiftCardSendLaterButton{
    display: inline-block;
    justify-content: center;
    cursor: pointer;
    background: #fff;
    line-height: 30px;
    margin:0px;
    padding:0px;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
    color: #585858;
    border: 1px solid #f3f3f3;
    border-top: 0 solid #f3f3f3;
    border-color: #f3f3f3!important;
}

.gktGiftCardSendNowButton:hover, .gktGiftCardSendLaterButton:hover{
   
}

.activeDeliveryOption{
    background: #A96668;
    color: #fff;
    box-shadow: inset 2px 2px 3px 0 rgb(0 0 0 / 13%), inset 0 0 5px -1px rgb(0 0 0 / 1%);
}

/*** Giftcard Modal Css ***/
.gktGiftCardModalPopupHeading{
    font-size:16px;
    margin:0;
    padding:10px;
}
.gktGiftCardModalSubText{
    font-size:16px;
    margin-bottom:10px;
}
.activeContent{
    font-weight:bold;
    color:black;
}

.gktDeliveryOptions{
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-gap:10px;
    margin:10px 0px;
}

.gktGiftCardModalBackButton{
    cursor:pointer;
    font-size: 14px;
    position: absolute;
    top: 10px;
    padding-top: 10px;
}
.greetingCardHeading{
    font-size:16px;
    margin:0 0 15px;

}

@media screen and (max-width: 600px) {
    .greetingCardMainBody{
        grid-template-columns: 1fr;
    }
    .greetingCardImagePreview{
        display:none;
        width:0;
    }

    .gktDeliveryOptions{
        display:grid;
        grid-template-columns: 1fr 1fr;
        grid-gap:10px;
    }
   
 }


/**** Checkmark css ***/
.gkt_checkmark {
    display:inline-block;
    position:absolute;
    top:10px;
    left:10px;
    width: 22px;
    height:22px;
    -ms-transform: rotate(45deg); /* IE 9 */
    -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
    transform: rotate(45deg);
}

.gkt_checkmark_circle {
    display:block !important;
    position: absolute;
    width:22px;
    height:22px;
    background-color: green;
    border-radius:11px;
    left:0;
    top:0;
    opacity:0.5;
}

.gkt_checkmark_stem {
    display:block !important;
    position: absolute;
    width:3px;
    height:9px;
    background-color:#fff;
    left:11px;
    top:6px;
}

.gkt_checkmark_kick {
    display:block !important;
    position: absolute;
    width:3px;
    height:3px;
    background-color:#fff;
    left:8px;
    top:12px;
}

</style>
<style>
.gktFreeGiftcardPopupModalWrapper {
    display: none;
    width: 100%;
    height: 100vh;
    position: fixed;
    opacity: 1;
    background: #e1d8d882;
    z-index: 999999999;
    top: 0;
    left: 0;
    overflow: hidden;
    animation-name: fadeIn_Container;
    animation-duration: .2s
    display: none;
 }
 .gktFreeGiftcardPopupConfirmationPageButtons{
     display:grid;
     grid-template-columns:1fr 1fr;
     grid-gap:10px;
 }
 .gktFreeGiftcardPopupButton, .gktFreeGiftcardPopupCheckoutButton, .gktFreeGiftcardPopupContinueShoppingButton{
    cursor: pointer;
    padding: 6px 12px;
    font-weight: 500;
    text-align: center;
    background-color: black;
    color: white;
    transition: transform .2s;
    font-size:16px; 
 }
 .gktFreeGiftcardPopupContinueShoppingButton{
    background-color: white;
    color: black;
 }
 .gktFreeGiftcardPopupConfirmationPageDescription{
    font-size: 16px;
    text-align: center;
    font-weight: 600;
    margin-bottom: 0;
    margin-top: 0;
    padding-top: 10px;
 }
 .gktFreeGiftcardPopupConfirmationPage{
 }
 .gktFreeGiftcardPopupModalClose{
    position:absolute;
    top:5px;
    right:5px;
    fill: rgba(255,255,255,0.851);
    background: rgba(32,33,36,0.4);
    -webkit-border-radius: 50%;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    padding: 1px;
    align-self: baseline;
    justify-self: end;
    margin-top: 3px;
    margin-right: 3px;
    cursor: pointer;
 }
 .gktFreeGiftcardPopupConfirmationPageImage{
    width: 100%;
    height: 150px !important;
    object-fit: cover !important;
 }
 .gktFreeGiftcardPopupModalClose:focus,
 .gktFreeGiftcardPopupModalClose:hover{
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
.gktFreeGiftcardPopupButton:hover, .gktFreeGiftcardPopupModalWrapper button:hover {
    transform: scale(0.95);
}
 .gktFreeGiftcardPopupModal {
    position: fixed;
    top: 25%;
    left: 50%;
    max-width: 450px;
    width: 45vw !important;
    margin: 10px auto;
    padding:10px 20px;
    margin-top: 20vh !important;
    border-radius: 4px;
    background: #fefefe;
    box-shadow: 0 0 10px #000;
    animation-name: fadeIn_Modal;
    animation-duration: .2s;
    transform: translate(-50%, -50%);
    line-height: 16px;
    max-height: 90vh;
    overflow-y: auto;
    overflow-x: hidden;
    display: none;
  }

  img.gktFreeGiftcardPopupImage {
    width: 100%;
    height: 200px;
  }

  .gktFreeGiftcardPopupHeading{
    font-size: 20px;
    margin: 0 !important;
    padding: 8px !important;
    text-align:center;
  }
  .gktFreeGiftcardPopupInputFields{
      display:grid;
      grid-gap:5px;
      margin: 0 !important;

  }
  .gktFreeGiftcardPopupInputFields > input{
    display: block;
    width: 100%;
    margin: 0 !important;
    padding: 10px 20px !important;
    background-color: #f3f4f3 !important;
    border: 1px solid #f3f4f3 !important;
    border-radius: 0px !important;
    font-size: 14px !important;
}

.gktFreeGiftcardPopupModalBody{
    height:100%;
    width:100%;
    display:grid;
    grid-gap:5px;
}
textarea.gktFreeGiftcardPopupTextArea{
    display: block;
    width: 100%;
    margin-top: 10px;
    resize:none;
    padding: 10px 20px !important;
    background-color: #f3f4f3 !important;
    border: 1px solid #f3f4f3 !important;
    border-radius: 0px !important;
    font-size: 14px !important;
    margin: 0 !important;
    min-height: 90px !important;
}
.gktFreeGiftcardPopupButton{
    display: block;
    width: 100%;
    margin-top: 0 !important;
    padding: 10px 20px;
}
.gktModalCheckoutButton:hover {
    transform: scale(0.95);
}
.gktModalCheckoutButton{
    cursor: pointer; 
}
.gktFreeGiftcardPopupInputFieldsEmailError{
    display: block;
    font-size: 12px;
    color: red;
    padding-top:2px;
}
@media only screen and (max-width: 600px) {
    .gktFreeGiftcardPopupModal {
        width: 90vw !important;
    }

</style>
  <style>
  
  .gktGiftMessageContainer {
     display:  grid;
     grid-template-columns: 1fr;
     grid-template-rows: auto;
     padding: 5px 0px;
  }
  
  .gktGiftMessageItemContainer{
      display:  grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      padding: 3px 0px;
      margin: 3px 0px;
      border-radius: 3px;x
      font-size: 14px;
  }
  
  .gktGiftMessageItemContainer label {
    margin-bottom: 0px
  }
  
  .gktGiftMessageItemContainerLabelText{
    align-self: center;
    font-size:14px;
    justify-self: left;
    text-align: left;
  }

  .gktGiftMessageItemContainerLabelText > p{
    padding: 0px;
    margin: 0px;
  }

  .gktGiftMessageImage{
     width: 40px;
      height: 40px;
      border: 1px solid #f1f2f3;
  }
  .gktGiftMessageItemContainerItem1{
      grid-row: 1 / 5;
  }
  
  .gktGiftMessageItemContainerItem2{
      
  }
  
  .gktGiftMessageItemContainerItem3{
      position: relative;
      display: flex;
      width: fit-content;
      height: 30px;
      border-radius: 4px;
      overflow: hidden;
  }
  
   label.gktCustomCheckboxMsgContainer {
      display: grid;
      grid-template-columns: 1fr;
      min-height: 30px;
      font-weight: 600;
  } 
  
  /* The container */
  .gktCustomCheckboxMsgContainer {
    display: block;
    position: relative;
    padding-left: 35px;
   
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Hide the browser's default checkbox */
  .gktCustomCheckboxMsgContainer input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }
  
  /* Create a custom checkbox */
  .gktCustomMsgCheckboxCheckmark {
    position: absolute;
    top: 2px;
    left: 0;
    height: 25px;
    width: 25px;
    border: 1px solid #a2a2a2;
    border-radius: 4px;
  }
  
  /* On mouse-over, add a grey background color */
  .gktCustomCheckboxMsgContainer:hover input ~ .gktCustomMsgCheckboxCheckmark {
    background-color: #ccc;
  }
  
  /* When the checkbox is checked, add a blue background 
  .gktCustomCheckboxMsgContainer input:checked ~ .gktCustomMsgCheckboxCheckmark {
    background-color: #2196F3;
  } */
  
  /* Create the gktCustomMsgCheckboxCheckmark/indicator (hidden when not checked) */
  .gktCustomMsgCheckboxCheckmark:after {
    content: "";
    position: absolute;
    display: none;
  }
  
  /* Show the gktCustomMsgCheckboxCheckmark when checked */
  .gktCustomCheckboxMsgContainer input:checked ~ .gktCustomMsgCheckboxCheckmark:after {
    display: block;
  }
  
  /* Style the gktCustomMsgCheckboxCheckmark/indicator */
  .gktCustomCheckboxMsgContainer .gktCustomMsgCheckboxCheckmark:after {
    left: 8px;
    top: 1px;
    width: 8px;
    height: 16px;
    border: solid #009c00;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  
  // textarea.gktGiftMessageTextArea:focus {
  //       border: none;
        
  //   }

  textarea.gktGiftMessageTextArea {
        display: none;
        border: 1px solid #b9babb;
        height: 60px;
        margin-left: 1px;
        -webkit-transition: all 0.6s ease-in-out;
        transition: all 0.6s ease-in-out;
        font-size: 14px;
        
    }

  </style>
  <style>
  
  .gktGiftMessageContainer {
     display:  grid;
     grid-template-columns: 1fr;
     grid-template-rows: auto;
     padding: 5px 0px;
  }
  
  .gktGiftMessageItemContainer{
      display:  grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      padding: 3px 0px;
      margin: 3px 0px;
      border-radius: 3px;x
      font-size: 14px;
  }
  
  .gktGiftMessageItemContainer label {
    margin-bottom: 0px
  }
  
  .gktGiftMessageItemContainerLabelText{
    align-self: center;
    font-size:14px;
    justify-self: left;
    text-align: left;
  }
  .gktGiftMessageImage{
     width: 40px;
      height: 40px;
      border: 1px solid #f1f2f3;
  }
  .gktGiftMessageItemContainerItem1{
      grid-row: 1 / 5;
  }
  
  .gktGiftMessageItemContainerItem2{
      
  }
  
  .gktGiftMessageItemContainerItem3{
      position: relative;
      display: flex;
      width: fit-content;
      height: 30px;
      border-radius: 4px;
      overflow: hidden;
  }
  
   label.gktGiftMsgAndWrapWrapperInnerEle {
      display: grid;
      grid-template-columns: 1fr;
      min-height: 30px;
      font-weight: 600;
  } 
  
  /* The container */
  .gktGiftMsgAndWrapWrapperInnerEle {
    display: block;
    position: relative;
    padding-left: 35px;
   
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Hide the browser's default checkbox */
  .gktGiftMsgAndWrapWrapperInnerEle input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }
  
  /* Create a custom checkbox */
  .gktCustomWrapCheckboxCheckmark {
    position: absolute;
    top: 2px;
    left: 0;
    height: 25px;
    width: 25px;
    border: 1px solid #a2a2a2;
    border-radius: 4px;
  }
  
  /* On mouse-over, add a grey background color */
  .gktGiftMsgAndWrapWrapperInnerEle:hover input ~ .gktCustomWrapCheckboxCheckmark {
    background-color: #ccc;
  }
  
  /* When the checkbox is checked, add a blue background 
  .gktGiftMsgAndWrapWrapperInnerEle input:checked ~ .gktCustomWrapCheckboxCheckmark {
    background-color: #2196F3;
  } */
  
  /* Create the gktCustomWrapCheckboxCheckmark/indicator (hidden when not checked) */
  .gktCustomWrapCheckboxCheckmark:after {
    content: "";
    position: absolute;
    display: none;
  }
  
  /* Show the gktCustomWrapCheckboxCheckmark when checked */
  .gktGiftMsgAndWrapWrapperInnerEle input:checked ~ .gktCustomWrapCheckboxCheckmark:after {
    display: block;
  }
  
  /* Style the gktCustomWrapCheckboxCheckmark/indicator */
  .gktGiftMsgAndWrapWrapperInnerEle .gktCustomWrapCheckboxCheckmark:after {
    left: 8px;
    top: 1px;
    width: 8px;
    height: 16px;
    border: solid #009c00;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  
  // textarea.gktGiftMessageTextArea:focus {
  //       border: none;
        
  //   }

  textarea.gktGiftMessageTextArea {
        display: none;
        border: 1px solid #b9babb;
        height: 60px;
        margin-left: 1px;
        -webkit-transition: all 0.6s ease-in-out;
        transition: all 0.6s ease-in-out;
        font-size: 14px;
    }

  </style>
<style>

.gktNotificationWrapper{
    position:fixed;
    margin: 0 !important;
    padding: 0 !important;
    top: 40px;
    right: 5px;
    display: none;
    z-index: 99999999999999;
}

.gktNotificationItem{
    margin: 4px 0px;
    background: white;
    color: black;
    padding: 4px 8px;
    -moz-box-shadow: 10px 10px 16px #000000;
    -webkit-box-shadow: 10px 10px 16px #000000;
    box-shadow: 0px 15px 30px rgba(0,0,0,0.08);
    max-width: 250px;
    display:grid;
    grid-template-columns: 30px 1fr 20px;
    justify-items: center;
    align-items: center;
    border-left: 5px solid green;
    border-radius: 4px;
    transform: translateX(300px);
    transition: 1s;
}

.gktNotificationItemContent{
    padding-right: 10px;

}

.gktNotificationItemContent2{
    display: grid;
    justify-self: start;
    align-self: center;

}

.gktNotificationItemContent3{
    display: grid;
    font-size: 14px;
    justify-self: start;
}
.gktNotificationItemContent4{
    display: grid;
    justify-self: end;
}




.gktNotificationItemContent3SubText{
    font-size: 12px;
}



</style>
<style>
    null

</style>

</div>
<div class="gktModalWrapper">
    <div class="gktModal">
        <div class="gktModalHeader">
            <!-- <strong class="gktModalPopupHeading"> </strong> -->
            <!-- <div class="gktModalClose"> &times; </div>   -->
            <div class="gktModalClose">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
                    </path>
                </svg>
            </div>
        </div>
        <div class="gktContentWrapper">
            <div class="gktLeftContent">
                <div class="gktJustifyCenter">
                    <label class="gktCheckboxLayout">
                        <input type="checkbox" checked="true" class="gktGiftMessageCheckbox">
                        <div class="gktMessageCheckboxHeading">

                        </div>
                    </label>
                </div>
                <textarea class="gktMessageTextarea gktAlignCenter">

                            </textarea>
            </div>
            <div class="gktRightContent">
                <div class="gktJustifyCenter">
                    <label class="gktCheckboxLayout">
                        <input type="checkbox" checked="true" class="gktGiftWrapCheckbox">
                        <div class="gktGiftWrapCheckboxHeading">

                        </div>
                    </label>
                </div>
                <img class="gktGiftWrapImage gktAlignCenter" loading="lazy">

            </div>
        </div>
        <div class="gktModalFooter">
            <div class="gktModalSave"></div>
        </div>
    </div>
</div>
</div>

<!-- modal for combo -->
</div>
<div class="gktComboModalWrapper">
    <div class="gktComboModal">
        <div class="gktComboModalHeader">
            <strong class="gktComboModalPopupHeading"> </strong>
            <!-- <div class="gktModalClose"> &times; </div>   -->
            <div class="gktComboModalClose">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
                    </path>
                </svg>
            </div>
        </div>
        <div class="gktComboContent">
            <div class="gktComboContentHeader"></div>
            <div class="gktComboContentFooter">
                <div class="gktComboContentFooterBtn1"></div>
                <div class="gktComboContentFooterBtn2"></div>
            </div>
        </div>

    </div>
</div>
</div>

</div>
<div class="gktGiftCardModalWrapper">
    <div class="gktGiftCardModal">
        <div class="gktGiftCardModalHeader">
            <strong class="gktGiftCardModalPopupHeading"> </strong>
            <!-- <div class="gktModalClose"> &times; </div>   -->
            <div class="gktGiftCardModalClose">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
                    </path>
                </svg>
            </div>
        </div>
        <div class="gktGiftCardContent">
            <div class="gktGiftCardContentHeader"></div>
            <form>
                <div class="gktGiftCardGreetingCardContent">
                   
                </div>
                <div class="gktGiftCardDetailsContent"></div>
            </form>
            <div class="gktGiftCardContentFooter">
                <div class="gktGiftCardContentFooterBtn1"></div>
            </div>
        </div>

    </div>
</div>
<div class="gktFreeGiftcardPopupModalWrapper">
    <div class="gktFreeGiftcardPopupModal">
    </div>
</div>
</div>
<div class="gktNotificationWrapper"></div>

<link rel="stylesheet" href="https://cdn.quilljs.com/1.2.6/quill.snow.css">


<script async>

    let tmpCartSettings = {"_id":"625e892200c021b18c68fb4b","cartPageText":"<p><strong style=\"font-size: 18px; color: rgb(230, 0, 0);\">🎁 Add Gift Wrap</strong></p>","popupCheckBoxText":"<p>Add Gift Wrap</p>","popupHeadingText":"<p><strong style=\"color: rgb(230, 0, 0); font-size: 34px;\">🎁 GIFT OPTIONS<span class=\"ql-cursor\"></span></strong></p>","popupImgUrl":"https://db07ji0eqime4.cloudfront.net/gift_popup/Pink-gifting.png","saveButtonBackgroundColor":"#353535","saveButtonTextColor":"#FFFFFF","saveButtonText":"SAVE","cartPopupBackgroundColor":"#FFFFFF","messageBoxplaceholder":"Add a personlized gift message here...","giftWrapImgUrl":"https://db07ji0eqime4.cloudfront.net/public/giftWrap_image.png","giftWrapShopifyImgUrl":"https://db07ji0eqime4.cloudfront.net/public/giftWrap_image.png","giftWrapTitle":"Wrap","giftWrapDesc":"All gift items are wrapped in high quality gift wrap before being securely packaged for delivery.","giftWrapPrice":"0.0","messageCheckboxHeading":"<p>Add Gift Message</p>","giftWrapCheckboxHeading":"<p>Add Gift Wrap</p>","enabledGifiting":"CART_PAGE","giftWrapHandle":null,"isVisibleOnCart":false,"isVisibleOnAllProductPages":false,"isVisibleOnSpecificProductPages":false,"visibleOnSpecificProductPages":[],"shopName":"bathbombsssq.myshopify.com","isGiftField":false,"isGiftWrap":false,"isGiftPrice":false,"productId":null,"productVariantId":null,"currency":"INR","themeId":"121711591529","createdAt":"2022-04-19T10:04:18.718Z","updatedAt":"2022-04-19T10:04:21.684Z","combos":[],"oneClickUpsells":[],"giftCards":[{"_id":"625ed1f12daf672cf754efa8","shopName":"bathbombsssq.myshopify.com","productId":"6843952595049","title":"GK1","shopifyData":{"id":6843952595049,"title":"GK1","body_html":"You can't go wrong with a gift card. Choose an amount and write a personalized message to make this gift your own.","vendor":"bathbombsssq.myshopify.com","product_type":"Gift Card","created_at":"2022-04-19T20:44:56+05:30","handle":"gk1","updated_at":"2022-04-20T11:47:03+05:30","published_at":"2022-04-19T20:44:56+05:30","template_suffix":null,"status":"active","published_scope":"web","tags":"gkt-gift-card(do not remove)","admin_graphql_api_id":"gid://shopify/Product/6843952595049","variants":[{"id":39979920326761,"product_id":6843952595049,"title":"10.00","price":"10.00","sku":"","position":1,"inventory_policy":"continue","compare_at_price":null,"fulfillment_service":"manual","inventory_management":null,"option1":"10.00","option2":null,"option3":null,"created_at":"2022-04-19T20:44:57+05:30","updated_at":"2022-04-19T20:44:57+05:30","taxable":false,"barcode":null,"grams":0,"image_id":null,"weight":0,"weight_unit":"kg","inventory_item_id":42076976513129,"inventory_quantity":0,"old_inventory_quantity":0,"requires_shipping":false,"admin_graphql_api_id":"gid://shopify/ProductVariant/39979920326761"},{"id":39979920359529,"product_id":6843952595049,"title":"20.00","price":"20.00","sku":"","position":2,"inventory_policy":"continue","compare_at_price":null,"fulfillment_service":"manual","inventory_management":null,"option1":"20.00","option2":null,"option3":null,"created_at":"2022-04-19T20:44:57+05:30","updated_at":"2022-04-19T20:44:57+05:30","taxable":false,"barcode":null,"grams":0,"image_id":null,"weight":0,"weight_unit":"kg","inventory_item_id":42076976545897,"inventory_quantity":0,"old_inventory_quantity":0,"requires_shipping":false,"admin_graphql_api_id":"gid://shopify/ProductVariant/39979920359529"},{"id":39979920392297,"product_id":6843952595049,"title":"30.00","price":"30.00","sku":"","position":3,"inventory_policy":"continue","compare_at_price":null,"fulfillment_service":"manual","inventory_management":null,"option1":"30.00","option2":null,"option3":null,"created_at":"2022-04-19T20:44:57+05:30","updated_at":"2022-04-19T20:44:57+05:30","taxable":false,"barcode":null,"grams":0,"image_id":null,"weight":0,"weight_unit":"kg","inventory_item_id":42076976578665,"inventory_quantity":0,"old_inventory_quantity":0,"requires_shipping":false,"admin_graphql_api_id":"gid://shopify/ProductVariant/39979920392297"}],"options":[{"id":8748893798505,"product_id":6843952595049,"name":"Value","position":1,"values":["10.00","20.00","30.00"]}],"images":[{"id":29614398505065,"product_id":6843952595049,"position":1,"created_at":"2022-04-20T11:47:03+05:30","updated_at":"2022-04-20T11:47:03+05:30","alt":null,"width":1600,"height":900,"src":"https://cdn.shopify.com/s/files/1/0555/8966/6921/products/1_d4ce15ea-7eb4-4391-97ed-286b50e44b29.png?v=1650435423","variant_ids":[],"admin_graphql_api_id":"gid://shopify/ProductImage/29614398505065"}],"image":{"id":29614398505065,"product_id":6843952595049,"position":1,"created_at":"2022-04-20T11:47:03+05:30","updated_at":"2022-04-20T11:47:03+05:30","alt":null,"width":1600,"height":900,"src":"https://cdn.shopify.com/s/files/1/0555/8966/6921/products/1_d4ce15ea-7eb4-4391-97ed-286b50e44b29.png?v=1650435423","variant_ids":[],"admin_graphql_api_id":"gid://shopify/ProductImage/29614398505065"}},"isDeleted":false,"createdAt":"2022-04-19T15:14:57.674Z","updatedAt":"2022-04-20T06:17:03.371Z","__v":0}],"giftMessage":{"_id":"625e892300c021b18c68fb58","shopName":"bathbombsssq.myshopify.com","isDeleted":false,"isGiftMessageEnabled":false,"isVisibleOnCart":false,"isVisibleOnAllProductPages":false,"isVisibleOnSpecificProductPages":false,"visibleOnSpecificProductPages":[],"createdAt":"2022-04-19T10:04:19.325Z","updatedAt":"2022-04-19T10:04:19.325Z","__v":0},"userData":{"shopName":"bathbombsssq.myshopify.com","countryCode":"IN","countryName":"India","currency":"INR","currencyInfo":{"code":"INR","symbol":"₹","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"customSettings":{"initialModalPopupCnt":0,"disableCartSettings":false,"addToCartBtnSelectors":null,"checkoutBtnSelectors":null,"customStyle":null,"addAfterAddTocartBtn":false,"addAftercheckoutBtn":false,"disableApp":false},"email":"rafathsweb@gmail.com"},"languageData":{"_id":"625e8922bd7f1643da8e15a4","shopName":"bathbombsssq.myshopify.com","__v":0,"createdAt":"2022-04-19T10:04:18.745Z","freeGiftcardPopup":{"freeGiftcardPopupHeading":{"id":"freeGiftcardPopupHeading","value":"You've unlocked a Free Gift Card! Share it with your friend now!","label":"Popup Heading","type":"text"},"namePlaceholder":{"id":"namePlaceholder","value":"Recipient Name","label":"Name Placeholder","type":"text"},"emailPlaceholder":{"id":"emailPlaceholder","value":"Recipient Email","label":"Email Placeholder","type":"text"},"notePlaceholder":{"id":"notePlaceholder","value":"Write a note","label":"Note Placeholder","type":"text"},"saveDetails":{"id":"saveDetails","value":"Save Details","label":"Save Detail Button","type":"text"},"checkoutButtonText":{"id":"checkoutButtonText","value":"Proceed to Checkout","label":"Checkout Button Text","type":"text"},"loadingCheckoutButtonText":{"id":"loadingCheckoutButtonText","value":"Loading...","label":"Loading Checkout Button Text","type":"text"},"emailErrorText":{"id":"emailErrorText","value":"Please enter a valid email address","label":"Email Error Text","type":"text"},"confirmationPageDescription":{"id":"confirmationPageDescription","value":"Recipient Details Saved. Gift Card will be sent once the Order is placed!","label":"Confirmation Page Description","type":"text"},"continueShoppingButtonText":{"id":"continueShoppingButtonText","value":"Continue Shopping","label":"Continue Shopping Button Text","type":"text"}},"giftcard":{"redemptionPageFields":[{"id":"pageHeading","label":"Page heading","type":"text","value":"Redeem Gift Card"},{"id":"giftcardCode","label":"Gift card code label","type":"text","value":"Gift Card Code"},{"id":"clipboardTooltipText","label":"Clipboard tooltip text","type":"text","value":"Copy the gift card code to your clipboard"},{"id":"clipboardTooltipConfirmationText","label":"Clipboard tooltip confirmation text","type":"text","value":"Copied to clipboard"},{"id":"balance","label":"Balance label","type":"text","value":"Balance"},{"id":"total","label":"Value label","type":"text","value":"Value"},{"id":"startShoppingBtn","label":"Start Shopping Button Text","type":"text","value":"Start Shopping"},{"id":"to","label":"To label","type":"text","value":"To"},{"id":"from","label":"From label","type":"text","value":"From"}],"purchasePageFields":{"modalDescription":{"id":"modalDescription","label":"Popup Description Text","type":"text","value":"Please provide the recipient's name and email address and we will send your gift card."},"recipientName":{"id":"recipientName","label":"Recipient name label","type":"text","value":"Recipient Name"},"recipientNamePlaceholder":{"id":"recipientNamePlaceholder","label":"Recipient name Placeholder","type":"text","value":"Recipient Name","optional":true},"recipientEmail":{"id":"recipientEmail","label":"Recipient email label","type":"text","value":"Recipient Email"},"recipientEmailPlaceholder":{"id":"recipientEmailPlaceholder","label":"Recipient email Placeholder","type":"text","value":"Recipient Email","optional":true},"senderName":{"id":"senderName","label":"Sender name label","type":"text","value":"Sender Name"},"senderNamePlaceholder":{"id":"senderNamePlaceholder","label":"Sender Name Placeholder","type":"text","value":"Sender Name...","optional":true},"giftNote":{"id":"giftNote","label":"Gift note label","type":"text","value":"Gift Note"},"giftNotePlaceholder":{"id":"giftNotePlaceholder","label":"Gift note placeholder","type":"text","value":"Enter a message for the recipient","optional":true},"buyNowButtonText":{"id":"buyNowButtonText","label":"Buy Now Button text","type":"text","value":"Send Gift Card"},"buyNowButtonTextLoading":{"id":"buyNowButtonTextLoading","label":"Buy Now Button text Loading","type":"text","value":"Loading checkout page"},"addToCartButtonText":{"id":"addToCartButtonText","label":"Send Gift Card button text","type":"text","value":"Send Gift Card"},"sendNowButtonText":{"id":"sendNowButtonText","label":"Send Now Button Text","value":"Send Now","type":"text"},"sendLaterButtonText":{"id":"sendLaterButtonText","label":"Send Later Button Text","value":"Send Later","type":"text"},"deliveryDate":{"id":"deliveryDate","label":"Delivery Date","value":"Delivery Date","type":"text"},"backButtonText":{"id":"backButtonText","label":"Back Button Text","value":"Back","type":"text"}},"greetingCardFields":{"greetingCardHeading":{"id":"greetingCardHeading","label":"Greeting Card Heading","type":"text","value":"Select a greeting Card"},"greetingCardContinueButtonText":{"id":"greetingCardContinueButtonText","label":"Greeting Card Continue Button Text","type":"text","value":"Continue"},"greetingCardCategory1":{"id":"greetingCardCategory1","label":"Greeting Card Category 1","type":"text","value":"General"},"greetingCardCategory2":{"id":"greetingCardCategory2","label":"Greeting Card Category 2","type":"text","value":"Occasion"},"greetingCardCategory3":{"id":"greetingCardCategory3","label":"Greeting Card Category 3","type":"text","value":"Holiday"}}},"isDeleted":false,"updatedAt":"2022-04-19T10:04:19.324Z","giftMessage":{"giftMessageHeadingLabel":"<p>Add Gift Note</p>","giftMessagePlaceholderText":"Enter your note here..."}},"greetingCardData":{"_id":"625e892400c021b18c68fb66","shopName":"bathbombsssq.myshopify.com","isDeleted":false,"isGreetingCardEnabled":false,"greetingCardImgs":[{"id":1,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/1.png","category":"Occasion","categoryId":"greetingCardCategory2"},{"id":2,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/2.png","category":"Occasion","categoryId":"greetingCardCategory2"},{"id":3,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/3.png","category":"Holiday","categoryId":"greetingCardCategory3"},{"id":4,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/4.png","category":"Holiday","categoryId":"greetingCardCategory3"},{"id":5,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/5.png","category":"General","categoryId":"greetingCardCategory1"},{"id":6,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/6.png","category":"General","categoryId":"greetingCardCategory1"},{"id":7,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/7.png","category":"General","categoryId":"greetingCardCategory1"},{"id":8,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/8.png","category":"General","categoryId":"greetingCardCategory1"},{"id":9,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/9.png","category":"General","categoryId":"greetingCardCategory1"},{"id":10,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/10.png","category":"General","categoryId":"greetingCardCategory1"},{"id":11,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/11.png","category":"General","categoryId":"greetingCardCategory1"},{"id":12,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/12.png","category":"Holiday","categoryId":"greetingCardCategory3"},{"id":13,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/13.png","category":"General","categoryId":"greetingCardCategory1"},{"id":14,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/14.png","category":"Occasion","categoryId":"greetingCardCategory2"},{"id":15,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/15.png","category":"Occasion","categoryId":"greetingCardCategory2"},{"id":16,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/16.png","category":"Occasion","categoryId":"greetingCardCategory2"},{"id":17,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/17.png","category":"Holiday","categoryId":"greetingCardCategory3"},{"id":18,"src":"https://db07ji0eqime4.cloudfront.net/public/greetingCardImages/18.png","category":"Holiday","categoryId":"greetingCardCategory3"}],"createdAt":"2022-04-19T10:04:20.113Z","updatedAt":"2022-04-19T10:04:20.113Z","__v":0},"freeGiftcardPopup":{}};//CART_SETTINGS_END

    let DEFAULT_addToCartBtnSelectors = 'input[name="add"], button[name="add"], form[action*="/cart/add"] input[type="submit"], form[action*="/cart/add"] button[type="submit"], form[action*="/cart/add"] button:not([type="button"]), form[action*="/cart/add"] .gkt__add-to-cart';
    let DEFAULT_checkoutBtnSelectors = 'button[name="checkout"], input[name="checkout"], form[action*="/cart"] a[href="/checkout"], a[href="/checkout"], form[action="/cart"] input[type="submit"][name="checkout"], form[action="/cart"] button[type="submit"][name="checkout"]';
    let DEFAULT_quantityBtnSelectors = '.ajaxcart__qty,quantity-input .quantity,.product-form__input, .product-form__quantity ';
    let DEFAULT_sideCartSelectors = '.cart-notification,cart-notification,.cart-notification-wrapper,#cart-notification, #CartDrawer, .drawer, .drawer-cover, .Drawer';
    let DEFAULT_buyNowBtn = '.shopify-payment-button__button, .shopify-payment-button__button--unbranded';
    let DEFAULT_cartForm = 'form[action="/cart"], form[action="/cart/"], form[action="cart"]';
    
    var cart_settings = {
        giftWrapProduct: {
            productId: tmpCartSettings.productId,
            productVairantID: tmpCartSettings.productVariantId,
            giftWrapPrice: tmpCartSettings.giftWrapPrice,
            giftWrapProductImage: tmpCartSettings.giftWrapImgUrl,
            giftWrapShopifyImgUrl: tmpCartSettings.giftWrapShopifyImgUrl,
            giftWrapHandle: tmpCartSettings.giftWrapHandle,
            isGiftWrapEnabled: tmpCartSettings.isGiftWrap,
            isVisibleOnCart: tmpCartSettings.isVisibleOnCart,
            isVisibleOnAllProductPages: tmpCartSettings.isVisibleOnAllProductPages,
            isVisibleOnSpecificProductPages: tmpCartSettings.isVisibleOnSpecificProductPages,
            visibleOnSpecificProductPages: tmpCartSettings.visibleOnSpecificProductPages
        },
        giftMessage: tmpCartSettings.giftMessage || {},
        popup: {
            popupHeadingText: tmpCartSettings.popupHeadingText,
            messageCheckboxHeading: tmpCartSettings.messageCheckboxHeading,
            giftWrapCheckboxHeading: tmpCartSettings.giftWrapCheckboxHeading,
            messageBoxplaceholder: tmpCartSettings.messageBoxplaceholder,
            saveButtonBackgroundColor: tmpCartSettings.saveButtonBackgroundColor,
            saveButtonTextColor: tmpCartSettings.saveButtonTextColor,
            saveButtonText: tmpCartSettings.saveButtonText,
            cartPopupBackgroundColor: tmpCartSettings.cartPopupBackgroundColor,
            reloadOnCancelClick: tmpCartSettings.reloadOnCancelClick
        },
        giftingOptions: {
            isGiftWrapEnabled: tmpCartSettings.isGiftWrap,
            isGiftMessageEnabled: tmpCartSettings.isGiftField,
            // enabledGifiting: "PRODUCT_PAGES_AND_CART_PAGE", "PRODUCT_PAGES", "CART_PAGE", "NONE",
            enabledGifiting: tmpCartSettings.enabledGifiting,
            shopifyPageinnerHTML: tmpCartSettings.cartPageText
        },
        pageWrapper: { cartPageText: tmpCartSettings.cartPageText },
        combos: tmpCartSettings.combos || [],
        oneClickUpsells: tmpCartSettings.oneClickUpsells || [],
        giftCards: tmpCartSettings.giftCards || [],
        greetingCards : tmpCartSettings.greetingCardData,
        freeGiftcardPopup: tmpCartSettings.freeGiftcardPopup,
        app: {
            disableApp: tmpCartSettings.userData.customSettings.disableApp || false,
            disableSideCart: tmpCartSettings.userData.customSettings.disableSideCart || false,
            refreshProductPageOnGiftWrap: tmpCartSettings.userData.customSettings.refreshProductPageOnGiftWrap || false,
            addToCartBtnSelectors: tmpCartSettings.userData.customSettings.addToCartBtnSelectors || DEFAULT_addToCartBtnSelectors,
            checkoutBtnSelectors: tmpCartSettings.userData.customSettings.checkoutBtnSelectors || DEFAULT_checkoutBtnSelectors,
            quantityBtnSelectors: tmpCartSettings.userData.customSettings.quantityBtnSelectors || DEFAULT_quantityBtnSelectors,
            sideCartSelectors: tmpCartSettings.userData.customSettings.sideCartSelectors || DEFAULT_sideCartSelectors,
            // cartDrawerSelectors: tmpCartSettings.userData.customSettings.cartDrawerSelectors || DEFAULT_cartDrawerSelectors,
            // sideCartDrawerOverlay: tmpCartSettings.userData.customSettings.sideCartDrawerOverlay || DEFAULT_sideCartDrawerOverlay,
            buyNowBtn: tmpCartSettings.userData.customSettings.buyNowBtn || DEFAULT_buyNowBtn,
            cartForm: tmpCartSettings.userData.customSettings.cartForm || DEFAULT_cartForm,
            addAfterAddTocartBtn:tmpCartSettings.userData.customSettings.addAfterAddTocartBtn || false,
            addAftercheckoutBtn: tmpCartSettings.userData.customSettings.addAftercheckoutBtn || false,
        },
        merchantInfo: tmpCartSettings.userData,
        languageData: tmpCartSettings.languageData,
    }

    let shopifyLiquidValues = {
        product: { handle: {{ product.handle | json }} },
        selected_or_first_available_variant: {{ product.selected_or_first_available_variant | json }},
        }

    var gktUtils = {
        f: {}
    }
    window.gktUtils = gktUtils;

    /*
    *fn(param1, param2) =>   
    *param1 is url of script that we suppose to load 
    *param2 is function that should be called after script is loaded 
    */
    gktUtils.f.loadScript = function (a, b) {
        var c = document.createElement("script");
        c.type = "text/javascript";
        c.src = a;
        document.getElementsByTagName("head")[0].appendChild(c)
        c.onload = function () { b() };
    };

    /*
    * we changed loadScript function - if else block for onload is removed as it was not making sense
    *fn(param1) =>  
    *param1 - represents function that should be executed once jquery is loaded 
    *https://www.w3schools.com/jquery/jquery_noconflict.asp
    */
    gktUtils.f.loadJquery = function (b) {
        console.log("does this work");
        "undefined" === typeof jQuery || 1.9 > parseFloat(jQuery.fn.jquery) ? gktUtils.f.loadScript("//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js", function () {
            gktJquery = jQuery.noConflict(!0);
            b(gktJquery)
        })
            :
            b(jQuery)
    };

    var gkt = {
        debug: [],
        version: 1.1,
        state: {
            submitted: "",
            product_added: "",
            page_type: "",
            insertWrapperOnPage: [],
            cartData: undefined,
            isOverWriteBuyNowBtnTriggered: false,
            timer: undefined,
            freeGiftcardPopupModalTriggered: false,
            gktFreeGiftcardBuyMoreProductNotificationSubHeadingShown: false,
        },
        constants: {
            themesIds: {
                DAWN_THEME: 887,
                VENTURE_THEME: 775,
                EXPRESS_THEME: 885,
                CRAVE_THEME: 1363,
                SENSE_THEME: 1356,
                CRAFT_THEME: 1368,
            }
        },
        settings: cart_settings, //object from function
        selectors: {
            addToCart: cart_settings.app.addToCartBtnSelectors,
            checkoutBtn: cart_settings.app.checkoutBtnSelectors,
            sideCartSelectors: cart_settings.app.sideCartSelectors,
            buyNowBtn: cart_settings.app.buyNowBtn,
            cartForm: cart_settings.app.cartForm,
            productPageWrapperV2: '.gktProductPageWrapperV2',
            cartPageWrapperV2: '.gktCartPageWrapperV2',
            quantityBtnSelectors : cart_settings.app.quantityBtnSelectors,
        },
        cartInterval: "",
        productinterval: "",
        f: {

            bootstrap: function (settings) {
                console.log("bootstap?");
                gkt.f.globalListener(settings)
                // gkt.gktGiftMsgAndWrap.init(settings);
                gkt.storage.loadValuesFromStorage(gkt.settings);
                gkt.themeSpecificCode.init(gkt.settings)

            },
            getPageType: function () {
                var pageType = "";
                if (window.location.pathname.includes("/cart") && !window.location.pathname.includes("/products")) {
                    pageType = "cart";
                } else if (window.location.pathname.includes("/products")) {
                    pageType = "product";
                } else if (window.location.pathname.includes("/collections")) {
                    pageType = "COLLECTION";
                } else if (window.location.pathname.includes("/")) {
                    pageType = "HOME";
                } else if ("undefined" != typeof Shopify && "undefined" != typeof Shopify.Checkout) {
                    pageType = "CHECKOUT";
                } else {
                    pageType = "PAGE_NOT_FOUND";
                }
                return pageType;
            },
            getProductPageHandle: function () {
                if ("product" === gkt.state.page_type && shopifyLiquidValues.product.handle) {
                    // let pattern = /(?<=\/products\/)((?!\?|\$).)+/g
                    // if(window && window.location && window.location.href){
                    //     return window.location.href.match(pattern)[0]
                    // }
                    return shopifyLiquidValues.product.handle

                }
                return "undefined"

            },
            getSelectedVariant: function () {
                if ("product" === gkt.state.page_type) {
                    if (ShopifyAnalytics && ShopifyAnalytics.meta && ShopifyAnalytics.meta.selectedVariantId) {
                        for(let i = 0; i < ShopifyAnalytics.meta.product.variants.length; i++){
                            if(ShopifyAnalytics.meta.product.variants[i].id == ShopifyAnalytics.meta.selectedVariantId){
                                return ShopifyAnalytics.meta.selectedVariantId
                            }
                        }
                    }
                    if (document.querySelector('[name="id"]') && document.querySelector('[name="id"]').value) {
                        return document.querySelector('[name="id"]').value
                    }
                    if (shopifyLiquidValues.selected_or_first_available_variant) {
                        return shopifyLiquidValues.selected_or_first_available_variant.id
                    }
                    return undefined
                }
            },
            getElements: function (settings) {
                return {
                    gktGiftMsgAndWrapWrapperParent: gkt.$(gkt.$.parseHTML('<div class="gktGiftMsgAndWrapHeader"><div class="gktGiftMsgAndWrapHeaderItem"><label for="gift-wrapping" class="gktGiftMsgAndWrapWrapperInnerEle"><input id="gift-wrapping" class="gktGiftOptionsCheckbox" type="checkbox" name="addGiftOptions"><span class="gktCustomWrapCheckboxCheckmark"></span><div class="gktGiftMsgAndWrapWrapperInnerEleHeading"></div></label> </div></div>')),
                    gktCartGiftMsgAndWrapWrapperParent: gkt.$(gkt.$.parseHTML('<div class="gktCartGiftMsgAndWrapHeader"><div class="gktCartGiftMsgAndWrapHeaderItem"><label for="gift-wrapping" class="gktGiftMsgAndWrapWrapperInnerEle"><input id="gift-wrapping" class="gktGiftOptionsCheckbox" type="checkbox" name="addGiftOptions"><span class="gktCustomWrapCheckboxCheckmark"></span><div class="gktGiftMsgAndWrapWrapperInnerEleHeading"></div></label></div></div>')),
                    addToCartBtn: gkt.$(document).find(gkt.selectors.addToCart),
                    addToCartButtonCloned: undefined,
                    checkoutBtn: gkt.$(document).find(gkt.selectors.checkoutBtn),
                    cartForm: gkt.$(document).find(gkt.selectors.cartForm),
                    productPageWrapperV2: gkt.$(gkt.$.parseHTML('<div class="gktPageWrapper gktProductPageWrapperV2"> <div class="gktComboWrapper"></div> <div class="gktProductPageUpsellWrapper"></div>  <div class="gktGiftMsgAndWrapWrapper"></div> <div class="gktGiftMessageWrapper"></div> </div>')),
                    cartPageWrapperV2: gkt.$(gkt.$.parseHTML('<div class="gktPageWrapper gktCartPageWrapperV2"> <div class="gktCartUpsellWrapper"></div> <div class="gktCartGiftMsgAndWrapWrapper"></div><div class="gktCartGiftMessageWrapper"></div> </div>')),
                    buyNowBtn: gkt.$(document).find(gkt.selectors.buyNowBtn)
                }
            },

            initialize: function (jQuery) {
                //  gkt.$.ajaxSetup({global: true});
                gkt.state.page_type = gkt.f.getPageType();
                gkt.elements = gkt.f.getElements(gkt.settings);
                if ("" === gkt.state.page_type) return false;
                return gkt.f.bootstrap(gkt.settings);
            },
            globalListener: function (settings) {
                let isIntervalActive = false
                //if app is disabled reurn
                if (settings.app.disableApp) {
                    return
                } else {
                    if ("product" === gkt.state.page_type) {
                        gkt.productPage.init(settings)
                    }

                    if (settings.app.disableSideCart) {
                        if ("cart" === gkt.state.page_type) {
                            gkt.cartPage.init(settings)
                        }
                    } else {
                        gkt.cartPage.init(settings)

                    }
                }

                setInterval(async () => {
                    if (!isIntervalActive) {
                        // console.log("globalListener-active")

                        isIntervalActive = true

                        // insert productpage wrapper if productPage is initialized
                        if ("product" === gkt.state.page_type &&
                            gkt.elements.addToCartBtn.length > 0 &&
                            gkt.$(document).find(gkt.selectors.productPageWrapperV2).length == 0) {
                            console.log("productPage-insertWrapperIntoPage1")
                            gkt.productPage.f.insertWrapperIntoPage(settings)
                        }

                        let checkoutBtnEle = gkt.$(document).find(gkt.selectors.checkoutBtn)

                        // insert cartPage wrapper if cartPage is initialized 
                        if (checkoutBtnEle.length > 0 &&
                            gkt.$(document).find(gkt.selectors.cartPageWrapperV2).length == 0) {
                            console.log("cartPage-insertWrapperIntoPage")
                            await gkt.cartPage.f.insertWrapperIntoPage(settings)
                        }

                        // check if comboproduct overwrite buyNowButton 
                        if (gkt.gktCombo.state.comboHandle != "") {
                            gkt.gktCombo.f.comboBuyNowButtonOverwrite()
                        }

                        // check if giftCard overwrite buyNowButton 
                        if (gkt.gktGiftCard.state.giftCardData) {
                            gkt.gktGiftCard.f.giftCardBuyNowButtonOverwrite()
                        }

                        // check if giftwrap, message or oneclick upsell overwrite buyNowButton
                        if(gkt.state.isOverWriteBuyNowBtnTriggered && gkt.$(document).find(".gkt-overwrite-buy-now-btn").length  == 0){
                            gkt.utility.overWriteBuyNowBtn()
                        }

                        if(gkt.state.page_type == "cart" && gkt.settings.freeGiftcardPopup.isFreeGiftcardPopupEnabled && gkt.state.freeGiftcardPopupModalTriggered != true ){
                         let currentCartValueEligible = await gkt.utility.isCartTotalMoreThan(gkt.settings.freeGiftcardPopup.cartValue)
                            if(currentCartValueEligible){
                                // gkt.gktFreeGiftCardPopup.action.showModal();
                                gkt.gktFreeGiftCardPopup.f.showGiftCard( gkt.settings,"CART_PAGE")
                                gkt.state.freeGiftcardPopupModalTriggered = true
                            }else{
                                if(gkt.$('.gktFreeGiftcardBuyMoreProductNotification').length == 0 && !gkt.state.gktFreeGiftcardBuyMoreProductNotificationSubHeadingShown){
                                    const freeGiftcardPopupLanguage = gkt.settings.languageData.freeGiftcardPopup
                                    if(freeGiftcardPopupLanguage?.BuyMoreItemHeading.value && freeGiftcardPopupLanguage?.BuyMoreItemHeading.value != ""){
                                        let gktFreeGiftcardBuyMoreProductNotificationSubHeading = gkt.$('<div>').addClass("gktFreeGiftcardBuyMoreProductNotification")
                                                                                                  .html(freeGiftcardPopupLanguage?.BuyMoreItemSubHeading?.value)
                                        gkt.gktNotification.f.addNotificationItemType1(freeGiftcardPopupLanguage?.BuyMoreItemHeading?.value, gktFreeGiftcardBuyMoreProductNotificationSubHeading, 100)
                                        gkt.state.gktFreeGiftcardBuyMoreProductNotificationSubHeadingShown = true

                                    }
                                   
                                }
                               
                            
                            
                            }
                        }
                        isIntervalActive = false

                    }
                }, 1000)
            }
        },
        utility: {
            getCookie: function (cookieName) {
                let name = cookieName + "=";
                let decodedCookie = decodeURIComponent(document.cookie);
                let ca = decodedCookie.split(";");
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == " ") {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return null;
            },
            setCookie: function (cookieName, cookieValue, expiryDays = 7) {
                const d = new Date();
                d.setTime(d.getTime() + expiryDays * 24 * 60 * 60 * 1000);
                let expires = "expires=" + d.toUTCString();
                document.cookie = cookieName + "=" + cookieValue + ";" + expires + ";path=/";
            },
            addToCart: async function (data) {

                try {
                    // if there is nothing to add in cart..just return true
                    if (!data.id) {
                        return true
                    }
                    let result = await gkt.$.ajax({
                        url: "/cart/add.js",
                        data: data,
                        type: "POST",
                        dataType: "json",
                    })
                    return true
                } catch (error) {
                    console.error("gkt-utility-addToCart");
                    console.error(error);
                    return false
                }
            },
            updateCart: async function (data) {
                try {
                    let result = await gkt.$.ajax({
                        type: "POST",
                        url: "/cart/update.js",
                        data: data,
                        dataType: "json",
                    });
                    return result
                } catch (error) {
                    console.error("gkt-utility-updateCart");
                    console.error(error);
                    return false
                }
            },
            changeCart: async function (data) {
                try {
                    let result = await gkt.$.ajax({
                        type: "POST",
                        url: "/cart/change.js",
                        data: data,
                        dataType: "json",
                    });
                    return true
                } catch (error) {
                    console.error("gkt-utility-changeCart");
                    console.error(error);
                    return false
                }
            },

            getProductData: async function (productName) {
                try {
                    let result = await gkt.$.ajax({
                        type: "GET",
                        url: "/products/" + productName,
                        // data: data,
                        dataType: "json",
                    });
                    return result;
                } catch (error) {
                    console.error("gkt-utility-updateCart");
                    console.error(error);
                    return false
                }
            },
            getProductDataV2: function (productName) {
                try {
                    return new Promise((res, rej) => {
                        gkt.$.getJSON("/products/" + productName + ".js", function (product) {
                            console.log("success-productName: ", productName)
                            res(product)
                        }).fail(function () { console.log("fail-productName: ", productName); res(false) })
                    })
                    return result;
                } catch (error) {
                    console.error("gkt-utility-getProductDataV2");
                    console.error(error);
                    return false
                }
            },
            addToCartV2: function (data) {
                try {
                    return new Promise((res, rej) => {
                        gkt.$.post('/cart/add.js', data)
                            .done(function () { console.log("success-/cart/add.js': "); res(true) })
                            .fail(function () { console.log("fail-/cart/add.js"); res(false) })
                    })
                    return result;
                } catch (error) {
                    console.error("gkt-utility-addToCartV2");
                    console.error(error);
                    return false
                }
            },
            clearCart: function (data) {
                try {
                    return new Promise((res, rej) => {
                        gkt.$.post('/cart/clear.js', data)
                            .done(function () { console.log("success-/cart/clear.js': "); res(true) })
                            .fail(function () { console.log("fail-/cart/clear.js"); res(false) })
                    })
                    return result;
                } catch (error) {
                    console.error("gkt-utility-clearCart");
                    console.error(error);
                    return false
                }
            },
            getCart: async function (data) {
                try {
                    let result = await gkt.$.ajax({
                        type: "GET",
                        url: "/cart.js",
                        dataType: "json",
                    });
                    return result
                } catch (error) {
                    console.error("gkt-utility-getCart");
                    console.error(error);
                    return false
                }
            },
            getCartTotalQuantity: async function () {
                try {
                    let total = 0
                    let cartData = await gkt.$.ajax({
                        type: "GET",
                        url: "/cart.js",
                        dataType: "json",
                    });
                    for (var item of cartData['items']) {
                        total += item["quantity"]
                    }
                    return total
                } catch (error) {
                    console.error("gkt-utility-getCart");
                    console.error(error);
                    return false
                }
            },
            checkIfItemPresentInCart: function (searchedVariantId) {
                if (gkt.state.cartData && gkt.state.cartData.items && gkt.state.cartData.items.length && gkt.state.cartData.items.length > 0) {
                    for (let i = 0; i < gkt.state.cartData.items.length; i++) {
                        let item = gkt.state.cartData.items[i]
                        if (item && item.variant_id && item.variant_id == searchedVariantId) {
                            return item
                        }
                    }
                    return false
                } else {
                    return false
                }
            },
            getNoteFromCart: function () {
                if (gkt.state.cartData && gkt.state.cartData.note && gkt.state.cartData.note != "") {

                    return gkt.state.cartData.note
                } else {
                    return false
                }
            },
            isCartTotalMoreThan: async function(value){
                gkt.state.cartData = await gkt.utility.getCart()

                if(gkt.state.cartData && gkt.state.cartData.total_price && ((gkt.state.cartData.total_price)/100 >= parseFloat(value))){
                    console.log("isCartTotalMoreThan: ", gkt.state.cartData.total_price)
                    return true
                }else{
                    return false
                }
            },
            cloneAddToCartBtn: function () {

            },
            overWriteBuyNowBtn: function (){
                
                let buyNowBtnEle = gkt.$(document).find(gkt.selectors.buyNowBtn)   

                if(buyNowBtnEle && buyNowBtnEle.length > 0 && gkt.$(document).find(".gkt-overwrite-buy-now-btn").length  == 0){
                    buyNowBtnEle.show()
                    buyNowBtnEle.unbind().unbind("click").off().off("click");
                    newBuyNowBtnEle = buyNowBtnEle.clone()
                    buyNowBtnEle.after(newBuyNowBtnEle)
                    buyNowBtnEle.hide()
                    newBuyNowBtnEle.addClass("gkt-overwrite-buy-now-btn")

                   // clone add to cart behavior 
                    // newBuyNowBtnEle.on("click", async function (event) {    
                    //      gkt.$(this).attr("disabled", true);
                    //     setTimeout(() => { gkt.$(this).attr("disabled", false); }, 1000)
                    //     event.preventDefault();
                    //     event.stopPropagation();
                    //     let selectedVariantId = gkt.f.getSelectedVariant()
                    //     let resAddToCart = await gkt.utility.addToCartV2({   "items": [
                    //                                         {
                    //                                             "id": selectedVariantId,
                    //                                             "quantity": 1
                    //                                         }
                    //                                         ]})
                    
                    //     window.location.href = window.location.origin + "/cart/checkout"
                    //     return
                    // })


                    newBuyNowBtnEle.on("click", function (event) {
                        event.preventDefault();
                        event.stopPropagation();
                        gkt.$(this).attr("disabled", true);
                        newBuyNowBtnEle.text("loading checkout...");
                        setTimeout(() => { gkt.$(this).attr("disabled", false)}, 3000)
                        addToCartBtnEle =  gkt.$(document).find(gkt.selectors.addToCart)
                        sideCartEle = gkt.$(document).find(gkt.selectors.sideCartSelectors) 

                        // gkt.$(document).find("body").addClass("loadingCheckoutPage")
                        // gkt.$(document).find("body").text("loading checkout...")

                        if(sideCartEle && sideCartEle.length > 0){
                            sideCartEle.css("display", "none")
                        }
                        
                        if(addToCartBtnEle && addToCartBtnEle.length > 0){
                            addToCartBtnEle.trigger("click")
                        }
                        setTimeout(()=>{
                            window.location.href = window.location.origin + "/cart/checkout"
                        },1000)
                        
                    })
                    
                }
            },
            emailValidation: function (emailString) {
                    var atSymbol = emailString.indexOf("@");
                    if (atSymbol < 1) return false;

                    var dot = emailString.lastIndexOf(".");                    
                    if (dot <= atSymbol + 2) return false;

                    // check that the dot is not at the end
                    if (dot === emailString.length - 1) return false;

                    return true;
                },
            slider: {
                state: {
                    slideIndex: 0,
                },
                plusSlides: function (selector, n) {
                    this.showSlides(selector, this.state.slideIndex += n);
                },
                //minusSlides
                minusSlides: function (selector, n) {
                    this.showSlides(selector, this.state.slideIndex -= n);
                },
                showSlides: function (selector, n) {
                    var i;
                    var slides = selector.find(".gktComboItemContainerItem1Img");
                    if (slides && slides.length) {
                        //     slides = JSON.parse(slides);
                        // }


                        if (n > slides.length) { this.state.slideIndex = 1 }
                        if (n < 1) { this.state.slideIndex = slides.length }
                        for (i = 0; i < slides.length; i++) {
                            slides[i].style.display = "none";
                        }
                        slides[this.state.slideIndex - 1].style.display = "block";
                        //   plusSlides(1)
                    }
                    // setTimeout(function () { plusSlides(n + 1) }, 2000);
                },
            },

        },
        storage: {

            loadValuesFromStorage: function (settings) {
                var gktGiftMessageCheckbox = sessionStorage.getItem("gktGiftMessageCheckbox");
                var gktMessageTextarea = sessionStorage.getItem("gktMessageTextarea");
                var gktGiftWrapCheckbox = sessionStorage.getItem("gktGiftWrapCheckbox");
                var gktGiftOptionsCheckbox = sessionStorage.getItem("gktGiftOptionsCheckbox");
                gkt.$('.gktMessageTextarea').val(gktMessageTextarea);

                if (gktGiftMessageCheckbox === null) {
                    gkt.$('.gktGiftMessageCheckbox').prop('checked', true);
                } else {
                    gkt.$('.gktGiftMessageCheckbox').prop('checked', gktGiftMessageCheckbox === "true");
                }

                if (gktGiftWrapCheckbox === null) {
                    gkt.$('.gktGiftWrapCheckbox').prop('checked', true);
                } else {
                    gkt.$('.gktGiftWrapCheckbox').prop('checked', gktGiftWrapCheckbox === "true");
                }

                if (gktGiftOptionsCheckbox === null) {

                    gkt.elements.cartPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', false)
                    gkt.elements.productPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', false)
                    gkt.$(document).find(".gktGiftOptionsCheckbox").prop('checked', false)
                } else {
                    gkt.elements.cartPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckbox === "true")
                    gkt.elements.productPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckbox === "true")
                    gkt.$(document).find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckbox === "true")

                }

            },
            setItem: function (field, value) {
                sessionStorage.setItem(field, value)
            },
            getItem: function (field) {
                return sessionStorage.getItem(field)
            }
        },
        drawerCart: {
            init: function (settings) {
                gkt.cartPage.init(settings)
            }
        },
        themeSpecificCode: {
            init: function (settings) {
                gkt.themeSpecificCode.f.ventureTheme(settings)
                gkt.themeSpecificCode.f.expressTheme(settings)
                gkt.themeSpecificCode.f.craveTheme(settings)
                gkt.themeSpecificCode.f.craftTheme(settings)
                gkt.themeSpecificCode.f.senseTheme(settings)


            },

            f: {
                ventureTheme: function () {
                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.VENTURE_THEME) {
                        // reload on save
                        gkt.selectors.sideCartDrawerOverlay = ""
                    }
                },
                expressTheme: function () {
                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.EXPRESS_THEME) {
                        // addd a css property of jusyify-items:cetner to cartpagewrapper
                        gkt.elements.cartPageWrapperV2.css("justify-items", "center")
                        if (window.location.pathname.includes("/cart")) {
                            gkt.selectors.checkoutBtn = ".cart__actions"
                        }
                    }
                },
                craveTheme: function () {
                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.CRAVE_THEME) {
                        // change css of cart__ctas in the document to block
                        gkt.$(document).find(".cart__ctas").css("display", "block")

                    }
                },
                craftTheme: function () {
                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.CRAFT_THEME) {
                        // change css of cart__ctas in the document to block
                        gkt.$(document).find(".cart__ctas").css("display", "block")

                    }
                },
                senseTheme: function () {
                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.SENSE_THEME) {
                        // change css of cart__ctas in the document to block
                        gkt.$(document).find(".cart__ctas").css("display", "block")

                    }
                },

            }
        },
        productPage: {
            init: async function (settings) {
                console.log("productPage-init")

                gkt.state.cartData = await gkt.utility.getCart()
                // gkt.state.insertWrapperOnPage.push("PRODUCT_PAGE")

                gkt.gktMessage.init(settings, "PRODUCT_PAGE")

                gkt.gktCombo.init(settings)

                gkt.gktGiftMsgAndWrap.init(settings, "PRODUCT_PAGE")

                gkt.gktOneClickUpsell.init(settings, "PRODUCT_PAGE")

                gkt.gktGiftCard.init(settings, "PRODUCT_PAGE")

                gkt.gktNotification.init(settings, "CART_PAGE")
            },
            f: {
                insertWrapperIntoPage: function (settings) {

                    if ("undefined" != typeof gkt.elements.addToCartBtn) {
                        let addToCartBtnEle = gkt.$(document).find(gkt.elements.addToCartBtn)
                        addToCartBtnEle.each(function (index) {
                            if (gkt.$(this).is(":visible")) {
                                if(gkt.settings.app.addAfterAddTocartBtn){
                                    gkt.$(this).after(gkt.elements.productPageWrapperV2);
                                }else{
                                    gkt.$(this).before(gkt.elements.productPageWrapperV2);
                                }
                                
                            }

                        });
                    }
                },
            },
             
            actions: {
                insertUpsellModal: function () {
                    //   Gs.$("body").append(Gs.settings._modalHtml);
                    alert("popModal for upsell action")
                },
            },
        },
        cartPage: {
            init: async function (settings) {

                gkt.state.cartData = await gkt.utility.getCart()

                gkt.gktMessage.init(settings, "CART_PAGE")

                gkt.gktGiftMsgAndWrap.init(settings, "CART_PAGE")

                gkt.gktOneClickUpsell.init(settings, "CART_PAGE")

                gkt.gktFreeGiftCardPopup.init(settings, "CART_PAGE")

                gkt.gktNotification.init(settings, "CART_PAGE")

            },
            f: {
                insertWrapperIntoPage: function (settings) {
                    return new Promise((res, rej) => {
                        if ("undefined" != typeof gkt.elements.checkoutBtn) {
                            let checkoutBtnEle = gkt.$(document).find(gkt.selectors.checkoutBtn)
                            checkoutBtnEle.each(function (index) {
                                // console.log("index", index)
                                if (gkt.$(this).is(":visible")) {
                                    // check if theme ids matches otherwise add element to default position
                                    if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gkt.constants.themesIds.DAWN_THEME) {
                                        gkt.$(this).parent().before(gkt.elements.cartPageWrapperV2);
                                    } else if(gkt.settings.app.addAftercheckoutBtn) {
                                        gkt.$(this).after(gkt.elements.cartPageWrapperV2);
                                    }else{
                                        gkt.$(this).before(gkt.elements.cartPageWrapperV2);
                                    }
                                }
                            });

                        }
                        res()
                    })
                },
            },
            events: {
                ajaxSuccess: function (cartSettings) {
                    console.log("register ajax success event")
                    gkt.$(document).ajaxSuccess(function (event, xhr, settings) {
                        console.log("ajaxSuccess", settings.url)
                        if (settings.url == "/change.js?line=1&quantity=0" || settings.url == "change.js?line=1&quantity=0" || settings.url == "change.js" || settings.url == "/change.js" || settings.url == "/cart.js" || settings.url == "cart.js" || settings.url == "cart" || settings.url == "/cart") {
                            setTimeout(function () {
                                console.log("ajaxSuccess")

                            }, 2000);
                        }
                    });
                }
            }
        },
        gktModal: {
            init: function (settings) {
                gkt.gktModal.initialize(settings)
                gkt.gktModal.events()
            },

            initialize: function (settings) {
                // case conditions  - isGiftWrap,isGiftField
                // media queries -responsive to ui 
                gkt.gktModal.actions.setModalBgColor();

                gkt.gktModal.actions.addModalPopupHeader();
                gkt.gktModal.actions.modalSaveBtn();

                const { isGiftWrapEnabled, isGiftMessageEnabled } = settings.giftingOptions;
                console.log({ isGiftWrapEnabled, isGiftMessageEnabled })
                if (isGiftMessageEnabled == true && isGiftWrapEnabled == true) {
                    gkt.gktModal.actions.modalGiftWrapContent();
                    gkt.gktModal.actions.modalGiftMessageContent();
                    //add a class called as gridLayout
                    gkt.$(".gktContentWrapper").addClass("gktGridLayout");
                }
                else if (isGiftMessageEnabled == false && isGiftWrapEnabled == true) {
                    gkt.gktModal.actions.modalGiftWrapContent();
                    gkt.gktModal.actions.hideModalGiftMessageContent();
                    //display image on mobile only if wrap is enabled
                    gkt.$(".gktGiftWrapImage").addClass("gktDisplayWrapImageOnPhone");

                }
                else if (isGiftMessageEnabled == true && isGiftWrapEnabled == false) {
                    gkt.gktModal.actions.modalGiftMessageContent();
                    gkt.gktModal.actions.hideModalGiftWrapContent();
                }

            },
            events: function () {
                console.log("gktModal-events")

                gkt.$(document).on("click", ".gktModalClose", gkt.gktModal.actions.onModalClose)
                gkt.$(document).on("click", ".gktModalSave", gkt.gktModal.actions.onModalSave)

            },

            actions: {
                onModalClose: function (event) {

                    // check if behavior is set to reload just reload the page
                    if (gkt.settings.popup.reloadOnCancelClick) {
                        window.location.reload()
                    }

                    //enable overlay
                    gkt.$(document).find(gkt.selectors.sideCartDrawerOverlay).css("display", "block");

                    // check the current state of giftingpopup and assign the same to it. 
                    gkt.gktGiftMsgAndWrap.action.syncWrapperCheckBoxState()

                    // hide the modal
                    gkt.$(".gktModalWrapper").hide();

                },
                onModalSave: async function (event) {
                    let isApiCallRequired = false
                    let updateCartData = { attributes: {} }
                    let addToCartData = {}

                    // check if gifwrapEnabled 
                    if (gkt.settings.giftingOptions.isGiftWrapEnabled) {
                        // check if giftwrap is checked or not
                        if (gkt.$(".gktGiftWrapCheckbox").prop('checked') == true) {
                            let productVairantId = gkt.settings.giftWrapProduct.productVairantID
                            // addToCartData  = {quantity: 1,id: gkt.settings.giftWrapProduct.productVairantID}
                            updateCartData.updates = { [productVairantId]: 1 }
                            updateCartData.attributes.giftWrap = "YES"
                            gkt.storage.setItem("gktGiftWrapCheckbox", true)
                        } else {

                            let productVairantId = gkt.settings.giftWrapProduct.productVairantID
                            // addToCartData  = {quantity: 0,id: gkt.settings.giftWrapProduct.productVairantID}
                            updateCartData.attributes.giftWrap = ""
                            updateCartData.updates = { [productVairantId]: 0 }
                            gkt.storage.setItem("gktGiftWrapCheckbox", false)
                        }
                    }


                    // check if giftMessageEnabled
                    if (gkt.settings.giftingOptions.isGiftMessageEnabled) {
                        if (gkt.$(".gktGiftMessageCheckbox").prop('checked') == true && gkt.$(".gktMessageTextarea").val() == "") {
                            gkt.$(".gktMessageTextarea").css("border", "3px solid red");
                            gkt.$(".gktMessageTextarea").attr("placeholder", "Please enter a gift message here");
                            gkt.$(".gktMessageTextarea").focus();
                            return true;

                        }
                        // check if giftMessage is checked or not
                        if (gkt.$(".gktGiftMessageCheckbox").prop('checked') == true) {
                            console.log("gktGiftMessageCheckbox checked-if")
                            var giftMessageValue = gkt.$(".gktMessageTextarea").val();
                            updateCartData.attributes.giftMessage = giftMessageValue
                            updateCartData.note = giftMessageValue
                            gkt.storage.setItem("gktMessageTextarea", giftMessageValue)
                            gkt.storage.setItem("gktGiftMessageCheckbox", true)
                            // 
                        }
                        else {
                            console.log("gktGiftMessageCheckbox checked-else")
                            updateCartData.attributes.giftMessage = ""
                            updateCartData.note = ""
                            gkt.storage.setItem("gktMessageTextarea", "")
                            gkt.storage.setItem("gktGiftMessageCheckbox", false)
                        }
                    }

                    // sync gift options checkbox state
                    // gkt.gktGiftMsgAndWrap.action.syncWrapperCheckBoxState()

                    // api call
                    gkt.utility.updateCart(updateCartData).then((data) => {
                        if (gkt.settings.app.refreshProductPageOnGiftWrap ||data && gkt.state.page_type == "cart") {
                            // gkt.utility.updateCart(updateCartData)
                            window.location.reload()
                        }
                    })
                    //enable overlay
                    gkt.$(document).find(gkt.selectors.sideCartDrawerOverlay).css("display", "block");

                    // hide the modal
                    gkt.$(".gktModalWrapper").hide();

                },
                modalGiftMessageContent: function () {
                    gkt.$(".gktMessageCheckboxHeading").html(gkt.settings.popup.messageCheckboxHeading);
                    gkt.$(".gktMessageTextarea").attr("placeholder", gkt.settings.popup.messageBoxplaceholder);
                },
                modalGiftWrapContent: async function () {
                    gkt.$(".gktGiftWrapCheckboxHeading").html(gkt.settings.popup.giftWrapCheckboxHeading);
                    let giftWrapProduct = await gkt.utility.getProductData(gkt.settings.giftWrapProduct.giftWrapHandle);
                    let wrapImage = gkt.settings.giftWrapProduct.giftWrapProductImage;
                    if (giftWrapProduct) {
                        wrapImage = giftWrapProduct.product.image.src;
                    }
                    gkt.$(".gktGiftWrapImage").attr("src", wrapImage);
                },
                modalSaveBtn: function () {
                    gkt.$(".gktModalSave").html(gkt.settings.popup.saveButtonText);
                    gkt.$(".gktModalSave").css("background-color", gkt.settings.popup.saveButtonBackgroundColor);
                    gkt.$(".gktModalSave").css("color", gkt.settings.popup.saveButtonTextColor);
                },
                hideModalGiftWrapContent: function () {
                    gkt.$(".gktRightContent").hide();
                },
                hideModalGiftMessageContent: function () {
                    gkt.$(".gktLeftContent").hide();
                },
                addModalPopupHeader: function () {
                    gkt.$(".gktModalPopupHeading").html(gkt.settings.popup.popupHeadingText);
                },
                setModalBgColor: function () {
                    gkt.$(".gktModal").css("background-color", gkt.settings.popup.cartPopupBackgroundColor);
                },
            }

        },
        gktGiftMsgAndWrap: {
            init: function (settings, parent) {
                gkt.gktGiftMsgAndWrap.initialize(settings, parent)
                gkt.gktGiftMsgAndWrap.events(settings)
                gkt.gktModal.init(settings)
            },
            initialize: function (settings, parent) {
                let productHandle = gkt.f.getProductPageHandle(settings)
                let {isEnabledOnProductPage, isEnabledOnCartPage} = gkt.gktGiftMsgAndWrap.f.checkifGiftWrapEnabled(settings.giftWrapProduct, productHandle, parent)
                if (parent == "PRODUCT_PAGE" && isEnabledOnProductPage) {
                    gkt.gktGiftMsgAndWrap.f.insertIntoProductPageWrapper(settings)
                    gkt.utility.overWriteBuyNowBtn()
                    gkt.state.isOverWriteBuyNowBtnTriggered = true
                    
                }
                if (parent == "CART_PAGE" && isEnabledOnCartPage) {
                    gkt.gktGiftMsgAndWrap.f.insertIntoCartPageWrapper(settings)
                }

                
            },
            f: {
                insertIntoProductPageWrapper: function (settings) {

                    gkt.elements.productPageWrapperV2.find(".gktGiftMsgAndWrapWrapper").css("display", "block")

                    let productVairantId = gkt.settings.giftWrapProduct.productVairantID
                    if (gkt.utility.checkIfItemPresentInCart(productVairantId)) {
                        gkt.elements.gktGiftMsgAndWrapWrapperParent.find('.gktGiftOptionsCheckbox').attr("checked", true)
                    }

                    // insert into parent element 
                    gkt.elements.gktGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEleHeading").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    gkt.elements.productPageWrapperV2.find(".gktGiftMsgAndWrapWrapper").append(gkt.elements.gktGiftMsgAndWrapWrapperParent);

                },
                insertIntoCartPageWrapper: function (settings) {

                    gkt.elements.cartPageWrapperV2.find(".gktCartGiftMsgAndWrapWrapper").css("display", "block")

                    let productVairantId = gkt.settings.giftWrapProduct.productVairantID
                    if (gkt.utility.checkIfItemPresentInCart(productVairantId)) {
                        gkt.elements.gktCartGiftMsgAndWrapWrapperParent.find('.gktGiftOptionsCheckbox').attr("checked", true)
                    }

                    // insert into parent element 
                    gkt.elements.gktCartGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEleHeading").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    gkt.elements.cartPageWrapperV2.find(".gktCartGiftMsgAndWrapWrapper").append(gkt.elements.gktCartGiftMsgAndWrapWrapperParent);

                },
                isAddgktGiftMsgAndWrapOnProductPage: function (settings) {
                    let flag = false
                    switch (settings.giftingOptions.enabledGifiting) {
                        case "PRODUCT_PAGES_AND_CART_PAGE":
                        case "PRODUCT_PAGES":
                            flag = true
                            break;
                    }
                    return flag
                },
                isAddgktGiftMsgAndWrapOnCartPage: function (settings) {
                    let flag = false
                    switch (settings.giftingOptions.enabledGifiting) {
                        case "PRODUCT_PAGES_AND_CART_PAGE":
                        case "CART_PAGE":
                            flag = true
                            break;
                    }
                    return flag
                },
                checkifGiftWrapEnabled: function (giftWrapProduct, currProductHandle, parent) {
                    let isEnabledOnProductPage = false
                    let isEnabledOnCartPage = false

                    if(!giftWrapProduct.isGiftWrapEnabled){
                        return {isEnabledOnProductPage, isEnabledOnCartPage}
                    }

                    if (giftWrapProduct.isVisibleOnCart) {
                        isEnabledOnCartPage = true
                    }

                    if (giftWrapProduct.isVisibleOnAllProductPages) {
                        isEnabledOnProductPage = true
                    } else if (giftWrapProduct.isVisibleOnSpecificProductPages &&
                            giftWrapProduct.visibleOnSpecificProductPages &&
                            giftWrapProduct.visibleOnSpecificProductPages.find(x => x.handle === currProductHandle)) {

                        isEnabledOnProductPage = true
                    }

                    return {isEnabledOnProductPage, isEnabledOnCartPage}
                }
            },
            events: function (settings) {
                    gkt.$(document).on("click", ".gktGiftOptionsCheckbox", async function (event) {
                        await gkt.gktGiftMsgAndWrap.action.handleGktGiftOptionsCheckboxEvent(event);
                        //gktPage type is cartPage then reload page
                        if (gkt.state.page_type == "cart") {
                            window.location.reload()
                            //turn off click events till the page loads
                            gkt.$("body").css("pointer-events", "none")
                        }
                    })

               
            },
            action: {
                syncWrapperCheckBoxState: function () {

                    let gktGiftOptionsCheckbox = gkt.storage.getItem("gktGiftOptionsCheckbox");
                    let gktGiftMessageCheckbox = sessionStorage.getItem("gktGiftMessageCheckbox");
                    let gktGiftWrapCheckbox = sessionStorage.getItem("gktGiftWrapCheckbox");

                    let gktGiftOptionsCheckboxValue = false
                    // check if all null, keep it chekc
                    if (gktGiftMessageCheckbox === null && gktGiftWrapCheckbox === null) {
                        gktGiftOptionsCheckboxValue = false
                    } else if ((gktGiftMessageCheckbox === "true" ? true : false) || (gktGiftWrapCheckbox === "true" ? true : false)) {
                        gktGiftOptionsCheckboxValue = true
                    } else {
                        gktGiftOptionsCheckboxValue = false
                    }

                    gkt.elements.cartPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckboxValue)
                    gkt.elements.productPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckboxValue)
                    gkt.$(document).find(".gktGiftOptionsCheckbox").prop('checked', gktGiftOptionsCheckboxValue)

                },

                setWrapperCheckBoxState: function (value) {
                    gkt.elements.cartPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', value)
                    gkt.elements.productPageWrapperV2.find(".gktGiftOptionsCheckbox").prop('checked', value)
                    gkt.$(document).find(".gktGiftOptionsCheckbox").prop('checked', value)
                },
                handleGktGiftOptionsCheckboxEvent: async function (cb) {
                    if (cb && cb.target) {
                        window.giftwrapEvent = cb
                        let productVairantId = gkt.settings.giftWrapProduct.productVairantID
                        //if true 
                        if (cb.target.checked) {
                            gkt.$(document).find('.gktGiftOptionsCheckbox').each(function () {gkt.$(this).attr("checked", true)})
                            await gkt.utility.updateCart({ updates: { [productVairantId]: 1 } })
                        }
                        else {
                            gkt.$(document).find('.gktGiftOptionsCheckbox').each(function () {gkt.$(this).attr("checked", false)})
                            await gkt.utility.updateCart({ updates: { [productVairantId]: 0 } })
                            gkt.$(document).find('.gktGiftOptionsCheckbox').attr("checked", false)
                        }

                    }

                }

            }
        },
        gktCombo: {
            init: function (settings) {
                gkt.gktCombo.initialize(settings)
            },
            currLoadingState: {
                isComboSoldOut: false,
                comboProductVariantIds: [],
                gktComboItemContainer: null,
                gktComboContainer: null,
            },
            state: {
                comboHandle: "",
                // update combo state here.
                isComboAddToCartButtonOverwrite: false,
                selectedComboProductsData: [],
                redirect: {},
                isComboBuyNowButtonOverwrite: false
            },
            initialize: async function (settings) {
                let productHandle = gkt.f.getProductPageHandle()
                let comboProduct = gkt.gktCombo.f.checkIfComboProduct(settings, productHandle)
                console.log("comboProduct:", comboProduct)
                // if this is combo product1
                if (comboProduct) {

                    gkt.gktCombo.state.comboHandle = comboProduct.handle
                    gkt.gktCombo.f.setInitialStateFromStorage(comboProduct.handle)

                    // redirect user to discount combo product page if discount is applied on combo
                    if (gkt.gktCombo.state.redirect && gkt.gktCombo.state.redirect.handle != comboProduct.handle) {
                        console.log("inside if redirect")
                        gkt.gktCombo.state.redirect.handle = comboProduct.handle
                        gkt.gktCombo.f.setComboStateToStorage()

                        if (comboProduct && comboProduct.discount && comboProduct.discount.title) {
                            // console.log("redirect")
                            window.location.href = window.location.origin + "/discount/" + comboProduct.discount.title + "?redirect=" + window.location.pathname
                        }
                    } else {
                        gkt.gktCombo.state.redirect = {}
                        gkt.gktCombo.f.setComboStateToStorage()
                    }

                    // get prodducts data of combo
                    let productsData = await gkt.gktCombo.f.getAllproductsInCombo(comboProduct)
                    gkt.gktCombo.f.setInitialCurrentState(comboProduct, productsData)

                    gkt.gktCombo.f.comboAddToCartButtonOverwrite()
                    gkt.gktCombo.f.comboBuyNowButtonOverwrite()
                    gkt.gktCombo.f.changeComboAddToCartButtonText("BUY NOW")
                    let comboUiHtml = gkt.gktCombo.f.prepareComboUi(settings, productsData)
                    gkt.gktCombo.f.insertIntoProductPageWrapper(settings, comboUiHtml)

                    if (gkt.gktCombo.currLoadingState.isComboSoldOut) {
                        gkt.gktCombo.f.changeComboAddToCartButtonText("SOLD OUT")
                        gkt.gktCombo.f.disabledComboAddToCartButton()
                    }
                }
            },
            f: {
                insertIntoProductPageWrapper: function (settings, comboUiHtml) {
                    gkt.elements.productPageWrapperV2.find(".gktComboWrapper").css("display", "block")
                    gkt.elements.productPageWrapperV2.find(".gktComboWrapper").append(comboUiHtml);
                    // gkt.elements.productPageWrapperV2.find(".gktComboWrapper").append(gkt.elements.addToCartBtn);

                },
                checkIfComboProduct: function (settings, currProductHandle) {
                    let combos = settings.combos
                    for (let i = 0; i < combos.length; i++) {
                        if (combos[i].handle == currProductHandle) {
                            return combos[i]
                        }

                    }
                    return undefined
                },
                getAllproductsInCombo: async function (comboProduct) {
                    let products = comboProduct.products
                    let apiCalls = []
                    for (let i = 0; i < products.length; i++) {
                        apiCalls.push(gkt.utility.getProductDataV2(products[i].handle))
                    }
                    let comboProductsData = await Promise.all(apiCalls)
                    console.log("Promise resolved")
                    return comboProductsData
                },
                comboAddToCartButtonOverwrite: async function () {

                    // set required states 
                    gkt.gktCombo.state.isComboAddToCartButtonOverwrite = true

                    gkt.elements.addToCartBtn.unbind().unbind("click").off().off("click");

                    gkt.elements.addToCartBtn.on("click", function (event) {
                        gkt.$(this).attr("disabled", true);
                        setTimeout(() => { gkt.$(this).attr("disabled", false); }, 1000)
                        gkt.gktCombo.action.comboAddToCartButton(event)

                    })
                },
                comboBuyNowButtonOverwrite: async function () {
                    if (gkt.$(document).find(gkt.selectors.buyNowBtn)) {
                        gkt.$(document).find(gkt.selectors.buyNowBtn).hide()
                    }
                },
                changeComboAddToCartButtonText: async function (insideHtml) {
                    if (gkt.gktCombo.state.isComboAddToCartButtonOverwrite) {
                        gkt.elements.addToCartBtn.html(insideHtml)
                    } else {
                        return false
                    }

                },
                disabledComboAddToCartButton: async function () {
                    if (gkt.gktCombo.state.isComboAddToCartButtonOverwrite) {
                        gkt.elements.addToCartBtn.prop("disabled", true);
                    } else {
                        return false
                    }
                },
                setComboStateToStorage: function () {

                    let comboState = gkt.gktCombo.f.getComboStateFromStorage()
                    comboState = { ...comboState, [gkt.gktCombo.state.comboHandle]: gkt.gktCombo.state }
                    gkt.storage.setItem('gktComboState', JSON.stringify(comboState))
                },
                getComboStateFromStorage: function () {

                    let state = gkt.storage.getItem('gktComboState')
                    if (state) {
                        state = JSON.parse(state)
                        return state
                    } else {
                        return {}
                    }
                },
                setInitialStateFromStorage: function (comboHandle) {
                    let comboState = gkt.gktCombo.f.getComboStateFromStorage()
                    let currCombostate = comboState[comboHandle]
                    if (currCombostate) {
                        gkt.gktCombo.state = currCombostate
                    }
                },
                prepareComboUi: function (settings, productsData) {
                    console.log("productsData", productsData)
                    gktComboContainer = gkt.$("<div>").addClass('gktComboContainer')
                    gkt.gktCombo.currLoadingState.gktComboContainer = gktComboContainer

                    for (let i = 0; i < productsData.length; i++) {
                        let productData = productsData[i]
                        if (!productData) {
                            continue
                        }

                        let gktComboItemContainer = gkt.$("<div>").addClass('gktComboItemContainer')
                        gkt.gktCombo.currLoadingState.gktComboItemContainer = gktComboItemContainer

                        let gktComboItemContainerItem1 = gkt.$("<div>").addClass('gktComboItemContainerItem1')
                        let gktComboItemContainerItem2 = gkt.$("<div>").addClass('gktComboItemContainerItem2')

                        let gktComboItemContainerItem3 = gkt.$("<div>").addClass('gktComboItemContainerItem3')
                        let gktComboItemContainerItem3CustomSelect = gktComboItemContainerItem3.append(gkt.$("<div>").addClass('gktComboItemContainerItem3CustomSelect'))
                        gktComboItemContainerItem3.find('.gktComboItemContainerItem3CustomSelect').append(gkt.$("<select>").addClass('gktComboItemContainerItem3Select'))

                        let gktComboItemContainerItem4 = gkt.$("<div>").addClass('gktComboItemContainerItem4')
                        gktComboItemContainer.append([gktComboItemContainerItem1, gktComboItemContainerItem2, gktComboItemContainerItem3, gktComboItemContainerItem4])
                        gktComboItemContainerItem3.find('.gktComboItemContainerItem3CustomSelect').append(gkt.$("<span>").addClass('gktComboItemContainerItem3SelectDropdownBtn'))
                        if (productData) {
                            for (let i = 0; i < productData.images.length; i++) {
                                let image = productData.images[i];
                                if (!image) {
                                    continue
                                }
                                if (image) {
                                    gktComboItemContainerItem1.append(gkt.$("<img>").addClass('gktComboItemContainerItem1Img' + i).addClass("gktComboItemContainerItem1Img"))
                                    gktComboItemContainerItem1.find('.gktComboItemContainerItem1Img' + i).attr('src', image).css('display', 'none').css('max-height', '100px')
                                }
                                if (i == 0) {
                                    gktComboItemContainerItem1.find('.gktComboItemContainerItem1Img' + i).css('display', 'block')
                                }
                            }

                            //push an anchor tag 
                            gktComboSliderNavigatior = gkt.$("<div>").addClass('gktComboSliderNavigatior')
                            gktComboSliderNavigatior.append(gkt.$("<a>").addClass('gktPrevImage'))
                            gktComboSliderNavigatior.find('.gktPrevImage').html("&#10094;");
                            //add an onclick event to the anchor tag
                            gktComboSliderNavigatior.append(gkt.$("<a>").addClass('gktNextImage'))
                            gktComboSliderNavigatior.find('.gktNextImage').html("&#10095;");

                            gktComboSliderNavigatior.find('.gktPrevImage').click(function () {
                                gkt.utility.slider.plusSlides(gktComboItemContainerItem1, 1)
                            })
                            gktComboSliderNavigatior.find('.gktNextImage').click(function () {
                                gkt.utility.slider.minusSlides(gktComboItemContainerItem1, 1)
                            })
                            gktComboItemContainerItem1.append(gktComboSliderNavigatior);

                            // add title 
                            gktComboItemContainerItem2.html(productData.title)


                            let addedVariantsCnt = 0
                            // add select options
                            for (let j = 0; j < productData.variants.length; j++) {
                                let variant = productData.variants[j]

                                // if variant is not available dont add it
                                if (!variant.available) {
                                    continue
                                }
                                // if variant is not selected in admin ui, dont add it
                                if (gkt.gktCombo.currLoadingState.comboProductVariantIds.indexOf(variant.id) == -1) {
                                    continue
                                }

                                addedVariantsCnt += 1

                                let variantName = variant.options.join(" / ")
                                let optionEle = gkt.$("<option>").attr("value", variant.id).addClass('gktComboItemContainerItem3SelectOption').html(variantName)
                                gktComboItemContainerItem3.find('.gktComboItemContainerItem3Select').append(optionEle)
                            }

                            if (addedVariantsCnt == 0) {
                                gkt.gktCombo.currLoadingState.isComboSoldOut = true
                            }
                            //hide dropdown if there is default variant of product
                            if (productData.variants.length == 1 && productData.variants[0].title && productData.variants[0].title == "Default Title") {
                                gktComboItemContainerItem3CustomSelect.hide()
                            }

                        } else {
                            gktComboItemContainerItem2.html("combo product not found")
                        }

                        gktComboContainer.append(gktComboItemContainer)
                    }



                    return gktComboContainer

                },
                setSelectedVariantsState: function () {
                    // set initialState for selected elements 
                    gkt.$('.gktComboContainer').find('.gktComboItemContainerItem3Select').each(function (index) {
                        console.log(index + ": " + gkt.$(this).val());
                        gkt.gktCombo.state.selectedComboProductsData[index] = { id: gkt.$(this).val() }
                    });
                    gkt.gktCombo.f.setComboStateToStorage()
                },
                openComboModal: function () {
                    gkt.$('.gktComboModalWrapper').css('display', 'block')
                },
                setInitialCurrentState: function (comboProduct, productsData) {

                    for (let i = 0; i < productsData.length; i++) {
                        let productData = productsData[i]
                        if (!productData) {
                            continue
                        }
                        if (!productData.available) {
                            gkt.gktCombo.currLoadingState.isComboSoldOut = true
                        }

                    }
                    let comboProducts = comboProduct.products ? comboProduct.products : []
                    for (let i = 0; i < comboProducts.length; i++) {
                        let variants = comboProducts[i].variants
                        if (variants && variants.length && variants.length > 0) {
                            variants.forEach(item => { gkt.gktCombo.currLoadingState.comboProductVariantIds.push(parseInt(item.variantId)) })
                        }

                    }
                }

            },
            action: {
                comboAddToCartButton: async function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    // add selected products to combo
                    gkt.gktCombo.f.setSelectedVariantsState()
                    let selectedComboProductsData = gkt.gktCombo.state.selectedComboProductsData
                    let items = []
                    for (let i = 0; i < selectedComboProductsData.length; i++) {
                        items.push({ quantity: 1, id: selectedComboProductsData[i].id })
                    }
                    let resAddToCart = await gkt.utility.addToCartV2({ items: items })

                    await gkt.utility.updateCart({ attributes:{"gktCombo":JSON.stringify(selectedComboProductsData)} })

                    // gkt.gktCombo.f.openComboModal()
                    window.location.href = window.location.origin + "/cart/checkout"
                    console.log("addToCartButtonClicked")
                }
            }
        },
        gktOneClickUpsell: {
            init: async function (settings, parent) {
                await gkt.gktOneClickUpsell.initialize(settings, parent)
                gkt.gktOneClickUpsell.f.registerEvents()
            },
            initialize: async function (settings, parent) {
                let productHandle = gkt.f.getProductPageHandle(settings)

                // write function which return two list 
                // oneClickUpsell products that need to be shown on this product page 
                // get the list of oneClickUpsellProducts that need to be shown on cart page 
                let { oneClickUpsellListForCartPage, oneClickUpsellListForProductPage } = gkt.gktOneClickUpsell.f.segregateOneClickUpsells(settings.oneClickUpsells, productHandle)

                if (parent == "PRODUCT_PAGE" && oneClickUpsellListForProductPage && oneClickUpsellListForProductPage.length && oneClickUpsellListForProductPage.length > 0) {
                    let variantListToBeShownOnProductPage = await gkt.gktOneClickUpsell.f.findVariantListToBeShown(oneClickUpsellListForProductPage)
                    let oneClickUpsellProductPageHTML = gkt.gktOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnProductPage, parent)
                    gkt.gktOneClickUpsell.f.insertIntoProductPageWrapper(settings, oneClickUpsellProductPageHTML)
                    console.log("variantListToBeShownOnProductPage", variantListToBeShownOnProductPage)
                    gkt.utility.overWriteBuyNowBtn()
                    gkt.state.isOverWriteBuyNowBtnTriggered = true
                    console.log("PRODUCT_PAGE")
                }

                if (parent == "CART_PAGE" && oneClickUpsellListForCartPage && oneClickUpsellListForCartPage.length && oneClickUpsellListForCartPage.length > 0) {
                    let variantListToBeShownOnCartPage = await gkt.gktOneClickUpsell.f.findVariantListToBeShown(oneClickUpsellListForCartPage)
                    let oneClickUpsellCartPageHTML = gkt.gktOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnCartPage, parent)
                    gkt.gktOneClickUpsell.f.insertIntoCartPageWrapper(settings, oneClickUpsellCartPageHTML)
                    console.log("variantListToBeShownOnCartPage", variantListToBeShownOnCartPage)
                    console.log("CART_PAGE")
                }

            },
            f: {

                segregateOneClickUpsells: function (oneClickUpsells, currProductHandle) {
                    let oneClickUpsellListForCartPage = []
                    let oneClickUpsellListForProductPage = []

                    for (let i = 0; i < oneClickUpsells.length; i++) {
                        let oneClickUpsell = oneClickUpsells[i]

                        // add products to cart page list
                        if (oneClickUpsell.isVisibleOnCart) {
                            oneClickUpsellListForCartPage.push(oneClickUpsell)
                        }

                        // add products to product page list 
                        if (oneClickUpsell.isVisibleOnAllProductPages) {

                            oneClickUpsellListForProductPage.push(oneClickUpsell)

                        } else if (oneClickUpsell.isVisibleOnSpecificProductPages &&
                            oneClickUpsell.visibleOnSpecificProductPages &&
                            oneClickUpsell.visibleOnSpecificProductPages.find(x => x.handle === currProductHandle)) {

                            oneClickUpsellListForProductPage.push(oneClickUpsell)
                        }

                    }

                    return {
                        oneClickUpsellListForCartPage: oneClickUpsellListForCartPage,
                        oneClickUpsellListForProductPage: oneClickUpsellListForProductPage
                    }
                },
                findVariantListToBeShown: async function (oneClickUpsellList) {
                    let responseData = []

                    let variantListSelectedByUser = []
                    let apiCalls = []

                    for (let i = 0; i < oneClickUpsellList.length; i++) {
                        let oneClickUpsell = oneClickUpsellList[i]

                        for (let j = 0; j < oneClickUpsell.upsellProducts.length; j++) {
                            let oneClickUpsellProduct = oneClickUpsell.upsellProducts[j]
                            apiCalls.push(gkt.utility.getProductDataV2(oneClickUpsellProduct.handle))

                            for (let k = 0; k < oneClickUpsellProduct.variants.length; k++) {
                                variantListSelectedByUser.push(parseInt(oneClickUpsellProduct.variants[k].variantId))
                            }
                        }

                    }

                    let oneClickUpsellProducts = await Promise.all(apiCalls)
                    // get required variants and return 
                    for (let i = 0; i < oneClickUpsellProducts.length; i++) {
                        let oneClickUpsellProduct = oneClickUpsellProducts[i]

                        if (!oneClickUpsellProduct) {
                            continue
                        }

                        for (let j = 0; j < oneClickUpsellProduct.variants.length; j++) {
                            let variant = oneClickUpsellProduct.variants[j]
                            //if variant.featured_image is null then take the onceClickUpsellProduct.featured_image
                            if (variant.featured_image) {
                                variant.featured_image = variant.featured_image.src
                            } else {
                                variant.featured_image = oneClickUpsellProduct.featured_image
                            }
                            //console.log("ashfaq");
                            // if variant is not available dont add it
                            if (!variant.available) {
                                continue
                            }

                            // if variant is not selected in admin ui, dont add it
                            if (variantListSelectedByUser.indexOf(variant.id) == -1) {
                                continue
                            }

                            responseData.push(variant)

                        }
                    }

                    return responseData

                },
                insertIntoProductPageWrapper: function (settings, oneClickUpsellHTML) {

                    gkt.elements.productPageWrapperV2.find(".gktProductPageUpsellWrapper").css("display", "block")

                    // // insert into parent element 
                    // gkt.elements.gktGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEle").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    gkt.elements.productPageWrapperV2.find(".gktProductPageUpsellWrapper").append(oneClickUpsellHTML);

                },
                insertIntoCartPageWrapper: function (settings, oneClickUpsellHTML) {

                    gkt.elements.cartPageWrapperV2.find(".gktCartUpsellWrapper").css("display", "block")

                    // insert into parent element 
                    // gkt.elements.gktCartGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEle").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    // gkt.elements.cartPageWrapperV2.find(".gktCartUpsellWrapper").append(gkt.elements.gktCartGiftMsgAndWrapWrapperParent);
                    gkt.elements.cartPageWrapperV2.find(".gktCartUpsellWrapper").append(oneClickUpsellHTML);

                },
                prepareUI: function (settings, variantListToBeShown, parent) {
                    let gktOneClickUpsellContainer = gkt.$("<div>").addClass('gktOneClickUpsellContainer')


                    for (let i = 0; i < variantListToBeShown.length; i++) {
                        let variant = variantListToBeShown[i]
                        let gktOneClickUpsellItemContainer = gkt.$("<div>").addClass('gktOneClickUpsellItemContainer')
                        let gktOneClickUpsellItemContainerCheckboxLable = gkt.$("<label>").addClass('gktCustomCheckboxContainer')
                        let inputCheckboxEle = gkt.$("<input>").addClass('gktOneClickUpsellInputCheckboxEle')
                            .attr("type", "checkbox")
                            .attr("data-variant", JSON.stringify(variant))
                            .attr("data-parent", JSON.stringify(parent))

                        if (gkt.utility.checkIfItemPresentInCart(variant.id)) {
                            inputCheckboxEle.attr("checked", true)
                        }
                        let gktOneClickUpsellImage = gkt.$("<img>").addClass('gktOneClickUpsellImage')
                            .attr("src", variant.featured_image)
                        gktOneClickUpsellImage.css("width", "40px")
                        gktOneClickUpsellImage.css("height", "40px")
                        gktOneClickUpsellImage.css("justify-self", "right")

                        gktOneClickUpsellItemContainerCheckboxLable.append(inputCheckboxEle)
                        gktOneClickUpsellItemContainerCheckboxLable.append(gkt.$("<span>").addClass("gktCustomCheckboxCheckmark"))


                        let appendString = "" + variant.name
                        let price = variant.price > 0 ? parseFloat(variant.price / 100) : variant.price
                        if (settings.merchantInfo && settings.merchantInfo.currencyInfo && settings.merchantInfo.currencyInfo.symbol) {
                            appendString = appendString + " + " + settings.merchantInfo.currencyInfo.symbol + price
                        }
                        //create a div with appendString 
                        let gktOneClickUpsellItemContainerLableText = gkt.$("<div>").addClass('gktOneClickUpsellItemContainerLabelText')
                            .text(appendString)
                        gktOneClickUpsellItemContainerCheckboxLable.append(gktOneClickUpsellItemContainerLableText)
                        gktOneClickUpsellItemContainer.append(gktOneClickUpsellItemContainerCheckboxLable)
                        gktOneClickUpsellItemContainerCheckboxLable.append(gktOneClickUpsellImage)
                        gktOneClickUpsellContainer.append(gktOneClickUpsellItemContainer)
                    }

                    return gktOneClickUpsellContainer
                },
                registerEvents: function () {
                    gkt.$(document).on("click", ".gktOneClickUpsellInputCheckboxEle", async function (event) {
                        await gkt.gktOneClickUpsell.actions.handleOneClickUpsellOnChangEvent(event);
                        //gktPage type is cartPage then reload page
                        if (gkt.state.page_type == "cart") {
                            window.location.reload()
                            //turn off click events till the page loads
                            gkt.$("body").css("pointer-events", "none")
                        }
                    })
                }
            },
            actions: {
                handleOneClickUpsellOnChangEvent: async function (cb) {
                    if (cb && cb.target) {
                        let variant = JSON.parse(cb.target.getAttribute("data-variant"))
                        let parent = cb.target.getAttribute("data-parent")

                        // if true 
                        if (cb.target.checked) {
                            await gkt.utility.updateCart({ updates: { [variant.id]: 1 }, attributes:{[variant.id]:"gktOneClickUpsellBuy"}})
                        }
                        else {
                            await gkt.utility.updateCart({ updates: { [variant.id]: 0 }, attributes:{[variant.id]:""} })
                        }

                    }

                }
            }

        },
        gktGiftCard: {
            init: async function (settings, parent) {
                await gkt.gktGiftCard.initialize(settings, parent)
                gkt.gktGiftCard.f.registerEvents()
            },
            state: {
                isGiftCardAddToCartButtonOverwrite: false,
                isGiftCardBuyNowButtonOverwrite: false,
                giftCardAddToCartButtonClone: "",
                giftCardData: undefined,
                giftCardDiv: undefined,
                greetingCardActiveImageSrc: undefined,
                greetingCardSelectedCategory: undefined,
                giftCardDeliveryOption: "sendNow",
                greetingCardImageListDiv: undefined,
            },
            initialize: async function (settings, parent) {
                let productHandle = gkt.f.getProductPageHandle()
                let giftCardProduct = gkt.gktGiftCard.f.checkIfGiftCardProduct(productHandle, settings.giftCards)

                if (giftCardProduct) {
                    gkt.gktGiftCard.state.giftCardData = giftCardProduct
                    gkt.gktGiftCard.f.giftCardAddToCartButtonOverwrite()
                    gkt.gktGiftCard.f.giftCardBuyNowButtonOverwrite()
                    gkt.gktGiftCard.f.changeGiftCardAddToCartButtonText(gkt.settings.languageData.giftcard.purchasePageFields.addToCartButtonText.value)
                    gkt.gktGiftCard.f.initializeModal()
                    console.log("giftCardProduct", giftCardProduct)

                    // initialize video messages 
                    // gkt.gktVideoMsg.init(settings, parent)
                }
                console.log("gktGiftCard initialize")
                console.log("settings.giftCard")
            },
            f: {
                checkIfGiftCardProduct: function (currProductHandle, giftCards) {
                    for (let i = 0; i < giftCards.length; i++) {
                        if (giftCards[i] && giftCards[i].shopifyData && giftCards[i].shopifyData.handle == currProductHandle) {
                            return giftCards[i]
                        }

                    }
                    return undefined
                },
                giftCardAddToCartButtonOverwrite: function () {

                    // set required states 
                    gkt.gktGiftCard.state.isGiftCardAddToCartButtonOverwrite = true

                    gkt.elements.addToCartBtn.unbind().unbind("click").off().off("click");

                    gkt.elements.addToCartBtn.on("click", function (event) {
                        // gkt.$(this).attr("disabled", true);
                        // setTimeout(() => { gkt.$(this).attr("disabled", false); }, 1000)
                        gkt.gktGiftCard.action.giftCardAddToCartButton(event)

                    })
                },
                giftCardBuyNowButtonOverwrite: function () {
                    // set required states 
                    gkt.gktGiftCard.state.isGiftCardBuyNowButtonOverwrite = true

                    if (gkt.$(document).find(gkt.selectors.buyNowBtn)) {
                        gkt.$(document).find(gkt.selectors.buyNowBtn).hide()
                    }
                },
                changeGiftCardAddToCartButtonText: function (insideHtml) {
                    if (gkt.gktGiftCard.state.isGiftCardAddToCartButtonOverwrite) {
                        gkt.elements.addToCartBtn.html(insideHtml)
                    } else {
                        return false
                    }

                },
                openGiftCardModal: function () {
                    gkt.$('.gktGiftCardModalWrapper').css('display', 'block')
                },
                registerEvents: function () {
                    gkt.$(document).on("click", ".gktGiftCardModalClose", gkt.gktGiftCard.action.onModalClose)
                },
                initializeModal: function () {
                    if(gkt.settings.greetingCards.isGreetingCardEnabled &&
                        gkt.settings.greetingCards.greetingCardImgs &&
                        gkt.settings.greetingCards.greetingCardImgs.length>0
                        ){
                        gkt.gktGiftCard.f.prepareGreetingCardUI()
                    }
                    else{
                        gkt.$('.greetingCardImageList').remove()
                        gkt.gktGiftCard.f.modalBuyNowButton();
                    }
                    gkt.gktGiftCard.f.prepareGiftCardUI();
                },
                renderGreetingCardImages:function(imageList){
                    if(imageList){
                    let greetingCardImageList = gkt.$("<div>").addClass("greetingCardImageList")
                    for (let i = 0; i < imageList.length; i++) {
                        let _img = imageList[i].src;
                        // add an input event listener to each image of radio type 
                        imageInput = gkt.$("<input>").attr("type", "radio").attr("name", "greetingCardImage").attr("value", imageList[i].src)
                        imageInput.addClass("greetingCardImageInput")
                        let imageLabel = gkt.$("<label>").addClass('greetingCardImageLabel')
                        let image = gkt.$("<img>").addClass('greetingCardImage')
                        
                        //on click set the current item to the preview image as active image
                        imageLabel.on("click", gkt.gktGiftCard.action.onGreetingCardImageClick)
                        
                        //if image is checked then attach activeGreetingCard css to it
                        if (gkt.gktGiftCard.state.greetingCardActiveImageSrc == imageList[i].src) {
                            imageInput.attr("checked", true)
                            imageLabel.addClass("activeGreetingCard")
                            gkt.gktGiftCard.action.addCheckMarkDivs(imageLabel);
                        }
                        image.attr("src", imageList[i].src)
                        imageLabel.append(imageInput)
                        imageLabel.append(image)
                        greetingCardImageList.append(imageLabel)
                      }
                    // if greetingCardImageList has no elements then return that there are no Images to display
                    if (greetingCardImageList.children().length == 0) {
                        return gkt.$("<div>").addClass('greetingCardImageList').html("No Images to display")
                        }
                    return greetingCardImageList;
                    }

                 },               
                changeGreetingCardImageList: function(category){
                    let imageList = gkt.settings.greetingCards.greetingCardImgs
                    let imageListFiltered = gkt.gktGiftCard.f.filterGreetingCardImages(imageList,category)
                    let greetingCardImageList = gkt.gktGiftCard.f.renderGreetingCardImages(imageListFiltered)
                    // find the div with class greetingCardImageList and replace it with the new one
                    gkt.gktGiftCard.state.greetingCardImageListDiv = greetingCardImageList;

                    gkt.$(".greetingCardImageList").replaceWith(greetingCardImageList)
                    return greetingCardImageList;
                },
                filterGreetingCardImages: function(imageList,category){
                    let imageListFiltered = []
                    for (let i = 0; i < imageList.length; i++) {
                        if(imageList[i].categoryId == category.id){
                            imageListFiltered.push(imageList[i])
                        }
                    }
                    return imageListFiltered
                },
                prepareGreetingCardUI : function (){
                    console.log("gktGiftCard.f.prepareGreetingCardUI")
                    const greetingCardFields = gkt.settings.languageData.giftcard.greetingCardFields
                    const heading = greetingCardFields.greetingCardHeading;
                    const continueButtonText = greetingCardFields.greetingCardContinueButtonText;
                    const greetingCardCategory = greetingCardFields.greetingCardCategory;
                    // This is where we have the greeting card categories, we need to render them in the modal as list items
                    const greetingCardCategories = [greetingCardFields.greetingCardCategory1,greetingCardFields.greetingCardCategory2,greetingCardFields.greetingCardCategory3]

                    let greetingCardContainer = gkt.$("<div>").addClass('gktGiftCardContainer')
                    let greetingCardMainBody = gkt.$("<div>").addClass('greetingCardMainBody')
                    let greetingCardHeading = gkt.$("<div>").addClass('greetingCardHeading')

                    
                    
                    greetingCardHeading.html(heading.value)

                    // add a line of categories which the user can click on
                    let greetingCardCategoryList = gkt.$("<ul>").addClass('greetingCardCategoryList')
                    let greetingCardCategoryListItem = gkt.$("<li>").addClass('greetingCardCategoryListItem')
                    let greetingCardCategoryListItemText = gkt.$("<a>").addClass('greetingCardCategoryListItemText')
                    let imageInput = undefined;
                    let imageList =  gkt.settings.greetingCards.greetingCardImgs;
                    
                    const getFirstImageFromGeneralCategory = imageList.find(x=>x.categoryId=="greetingCardCategory1");
                    if(getFirstImageFromGeneralCategory){
                        gkt.gktGiftCard.state.greetingCardActiveImageSrc = getFirstImageFromGeneralCategory.src
                    }
                    
                    gkt.gktGiftCard.state.greetingCardImageListDiv = gkt.gktGiftCard.f.renderGreetingCardImages(imageList)
                    
                    for (let i = 0; i < greetingCardCategories.length; i++) {
                        let greetingCardCategoryListItemClone = gkt.$(greetingCardCategoryListItem).clone()
                        let greetingCardCategoryListItemTextClone = gkt.$(greetingCardCategoryListItemText).clone()
                        greetingCardCategoryListItemTextClone.html(greetingCardCategories[i].value)
                      
                        // Select the first category as default (General)
                        if(i == 0){
                            const _this =  greetingCardCategoryListItemClone[0];
                            gkt.gktGiftCard.state.greetingCardSelectedCategory = greetingCardCategories[0]
                            gkt.gktGiftCard.action.onGreetingCardCategoryClick.call(_this)
                        }
                        greetingCardCategoryListItemClone.on("click",function(){
                            gkt.gktGiftCard.state.greetingCardSelectedCategory=greetingCardCategories[i]
                            gkt.gktGiftCard.action.onGreetingCardCategoryClick.call(this)
                        })
                        greetingCardCategoryListItemClone.append(greetingCardCategoryListItemTextClone)
                        greetingCardCategoryList.append(greetingCardCategoryListItemClone)
                    }
                   
                    // REASON: Planned of using a preview, but later dropped. This is hidden in the css file display:none
                    // greetingCardImagePreview.append(gkt.$("<img>").addClass('greetingCardImagePreview').attr("src",))
                   
                    // greetingCardMainBody.append(greetingCardImagePreview)
                    // remove duplicates of greetingCardImageList and just keep the first one

                    // const duplicates = gkt.$(".greetingCardImageList").length;
                    // for(let i=0; i<duplicates-1; i++){
                    //     gkt.$(".greetingCardImageList").first().remove()
                    // }
                    let imageListFiltered = gkt.gktGiftCard.f.filterGreetingCardImages(imageList,greetingCardCategories[0])
                    let greetingCardImageListHTML =  gkt.gktGiftCard.f.renderGreetingCardImages(imageListFiltered)
                    greetingCardMainBody.html(greetingCardImageListHTML)

                    greetingCardContainer.append(greetingCardHeading)
                    greetingCardContainer.append(greetingCardCategoryList)
                    greetingCardContainer.append(greetingCardMainBody)

                    let gktGiftCardGreetingCardContent = gkt.$(".gktGiftCardGreetingCardContent")
                    gktGiftCardGreetingCardContent.append(greetingCardContainer)
                    gkt.$(".gktGiftCardContentFooterBtn1").html(continueButtonText.value);
                    gkt.gktGiftCard.action.hideGiftcardDetailsBody();
                    gkt.gktGiftCard.f.modalNextButton();

                },
                prepareGiftCardUI: function () {
                    console.log("gktGiftCard.f.prepareGiftCardUI")

                    console.log("line 1670", gkt.settings.languageData.giftcard.purchasePageFields);
                    let { modalHeading, modalDescription, recipientName, recipientNamePlaceholder, recipientEmail, recipientEmailPlaceholder, senderName, senderNamePlaceholder, giftNote, giftNotePlaceholder, buyNowButtonText,backButtonText,deliveryDate,sendNowButtonText,sendLaterButtonText } = gkt.settings.languageData.giftcard.purchasePageFields;
                    
                    let gktGiftCardModalPopupHeading = gkt.$("gktGiftCardModalPopupHeading")
                    let gktGiftCardModalHeader = gkt.$(".gktGiftCardModalHeader")

                    let gktGiftCardModalSubText = gkt.$("<div>").addClass("gktGiftCardModalSubText")
                    gktGiftCardModalSubText.append(modalDescription.value);
                    // introduce a Back button as well
                    if(gkt.settings.greetingCards.isGreetingCardEnabled && 
                        gkt.settings.greetingCards.greetingCardImgs &&
                        gkt.settings.greetingCards.greetingCardImgs.length>0){

                        var gktGiftCardModalBackButton = gkt.$("<div>").addClass("gktGiftCardModalBackButton")
                        gktGiftCardModalBackButton.html("< ").append(backButtonText.value)
                        gktGiftCardModalBackButton.on("click", function () {
                        gkt.gktGiftCard.action.hideGiftcardDetailsBody();
                        gkt.gktGiftCard.action.showGreetingCardBody();
                        })
                    }
                  
                    //commented as we no longer use the modal header as Back button is the one on the top 
                    // gktGiftCardModalPopupHeading.html(modalHeading.value)

                    //insert gktGiftCardModalSubText after gktGiftCardModalHeader
                   

                    let gktGiftCardToInputField = gkt.$("<input>").attr("type", "text").attr("placeholder", recipientNamePlaceholder.value).addClass("gktGiftCardToInputField");
                    let gktGiftCardEmailInputField = gkt.$("<input>").attr("type", "email").attr("placeholder", recipientEmailPlaceholder.value).addClass("gktGiftCardEmailInputField");
                    let gktGiftCardFromInputField = gkt.$("<input>").attr("type", "text").attr("placeholder", senderNamePlaceholder.value).addClass("gktGiftCardFromInputField");
                    // a date picker 
                    let gktGiftCardDatePicker = gkt.$("<input>").attr("type", "date").addClass("gktGiftCardDatePicker"); 
                    //  todays date is the default value
                    gktGiftCardDatePicker.attr("value", new Date().toISOString().slice(0, 10));  
                    let gktGiftCardMessageInputField = gkt.$("<textarea>").attr("type", "text").attr("placeholder", giftNotePlaceholder.value).addClass("gktGiftCardMessageInputField").attr("rows", "4");


                    let gktGiftCardEmailValidation = gkt.$("<p>", { class: "gktGiftCardEmailValidation" });
                    let gktGiftCardDateValidation = gkt.$("<p>", { class: "gktGiftCardDateValidation" });
                    // add a label to all of these fields
                    let gktGiftCardToLabel = gkt.$("<label>").addClass("gktGiftCardToLabel").html(recipientName.value)
                    let gktGiftCardFromLabel = gkt.$("<label>").addClass("gktGiftCardFromLabel").html(senderName.value)
                    let gktGiftCardEmailLabel = gkt.$("<label>").addClass("gktGiftCardEmailLabel").html(recipientEmail.value)
                    let gktGiftCardMessageLabel = gkt.$("<label>").addClass("gktGiftCardMessageLabel").html(giftNote.value)
                    let gktGiftCardDateLabel = gkt.$("<label>").addClass("gktGiftCardDateLabel").html(deliveryDate.value)  
                        
                    // create two buttons, detailing Delivery Options
                    let gktDeliveryOptions = gkt.$("<div>").addClass("gktDeliveryOptions")
                    let gktGiftCardSendNowButton = gkt.$("<button>").addClass("gktGiftCardSendNowButton").html(sendNowButtonText.value);
                    let gktGiftCardSendLaterButton = gkt.$("<button>").addClass("gktGiftCardSendLaterButton").html(sendLaterButtonText.value);

                    // type as button else they autosubmit the form.
                    gktGiftCardSendNowButton.attr("type", "button");
                    
                    gktGiftCardSendNowButton.addClass("activeDeliveryOption");

                    gktGiftCardSendLaterButton.attr("type", "button");
                    
                    gktDeliveryOptions.append(gktGiftCardSendNowButton)
                    gktDeliveryOptions.append(gktGiftCardSendLaterButton)
                    // add all of these to the gktGiftCardDateLabel
                    gktGiftCardDateLabel.append(gktDeliveryOptions)

                    //create add video message 
                    // let gktVideoMsgButton = gkt.$("<button>").addClass("gktVideoMsgButton").html("Send a video message");

                    //add onClickFunctionality to Send Later which opens up a date picker
                    gktGiftCardSendLaterButton.on("click", function () {
                        gktGiftCardDatePicker.css("display", "block");
                        gktGiftCardSendLaterButton.addClass("activeDeliveryOption")
                        gkt.gktGiftCard.state.giftCardDeliveryOption = "sendLater"
                        gktGiftCardSendNowButton.removeClass("activeDeliveryOption")
                        gktGiftCardDateLabel.append(gktGiftCardDatePicker).append(gktGiftCardDateValidation)
                    })

                    gktGiftCardSendNowButton.on("click", function () {
                        gktGiftCardDatePicker.css("display", "none");
                        gktGiftCardSendNowButton.addClass("activeDeliveryOption")
                        gktGiftCardSendLaterButton.removeClass("activeDeliveryOption")
                        gkt.gktGiftCard.state.giftCardDeliveryOption = "sendNow"
                    })

                    gktGiftCardToLabel.attr("required", true)
                    gktGiftCardFromLabel.attr("required", true)
                    gktGiftCardEmailLabel.attr("required", true)
                    gktGiftCardMessageLabel.attr("required", true)
                    // add todays date as default value
                    gktGiftCardDatePicker.attr("value", new Date().toISOString().slice(0, 10))
                    //attach a date min and max value attr to the date picker
                    gktGiftCardDatePicker.attr("min", new Date().toISOString().slice(0, 10));
                    // and max date is set to the 30 days after
                    gktGiftCardDatePicker.attr("max", new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10));

                    // add all of these fields to a div
                    let gktGiftCardInputFieldsDiv = gkt.$("<div>").addClass("gktGiftCardInputFieldsDiv")
                    let gktGiftCardInputRow1 = gkt.$("<div>").addClass("gktGiftCardInputRow1")
                    // let gktGiftCardInputRow1Div1 = gkt.$("<div>").addClass("gktGiftCardInputRow1Div1")
                    // let gktGiftCardInputRow1Div2 = gkt.$("<div>").addClass("gktGiftCardInputRow1Div2")
                    let gktGiftCardInputRow2 = gkt.$("<div>").addClass("gktGiftCardInputRow2")
                    let gktGiftCardInputRow3Div1 = gkt.$("<div>").addClass("gktGiftCardInputRow3Div1")
                    let gktGiftCardInputRow3 = gkt.$("<div>").addClass("gktGiftCardInputRow3")

                    let gktGiftCardInputRow4 = gkt.$("<div>").addClass("gktGiftCardInputRow4")
                    let gktGiftCardInputRow5 = gkt.$("<div>").addClass("gktGiftCardInputRow5")

                    // gktGiftCardInputRow1.append(gktGiftCardInputRow1Div1).append(gktGiftCardInputRow1Div2)
                    gktGiftCardInputRow1.append(gktGiftCardToLabel).append(gktGiftCardToInputField)
                    gktGiftCardInputRow2.append(gktGiftCardEmailLabel).append(gktGiftCardEmailInputField).append(gktGiftCardEmailValidation)
                    // gktGiftCardInputRow3Div1.
                    gktGiftCardInputRow3.append(gktGiftCardFromLabel).append(gktGiftCardFromInputField)
                    gktGiftCardInputRow4.append(gktGiftCardMessageLabel).append(gktGiftCardMessageInputField)
                    gktGiftCardInputRow5.append(gktGiftCardDateLabel)

                    gktGiftCardInputFieldsDiv.append(gktGiftCardInputRow1)
                    gktGiftCardInputFieldsDiv.append(gktGiftCardInputRow2)
                    gktGiftCardInputFieldsDiv.append(gktGiftCardInputRow3)
                    gktGiftCardInputFieldsDiv.append(gktGiftCardInputRow4)
                    gktGiftCardInputFieldsDiv.append(gktGiftCardInputRow5)

                    
                    let gktGiftCardDetailsContent = gkt.$(".gktGiftCardDetailsContent")

                    gktGiftCardDetailsContent.append(gktGiftCardModalSubText)

                    if(gkt.settings.greetingCards.isGreetingCardEnabled &&
                        gkt.settings.greetingCards.greetingCardImgs &&
                        gkt.settings.greetingCards.greetingCardImgs.length>0
                        ){
                        gktGiftCardDetailsContent.append(gktGiftCardModalBackButton)
                    }

                    gktGiftCardDetailsContent.append(gktGiftCardInputFieldsDiv)
                    // gktGiftCardDetailsContent.append(gktVideoMsgButton)
                    

                },
                modalBuyNowButton: function () {
                    gkt.$(".gktGiftCardContentFooterBtn1").html(gkt.settings.languageData.giftcard.purchasePageFields.buyNowButtonText.value);
                    gkt.$(".gktGiftCardContentFooterBtn1").css("background-color", "#ffffff");
                    gkt.$(".gktGiftCardContentFooterBtn1").css("color", "#000000");
                    gkt.$(".gktGiftCardContentFooterBtn1").css("border", "1px solid #000000");
                    gkt.$(".gktGiftCardContentFooterBtn1").on("click", function (event) {
                        gkt.$(this).attr("disabled", true);
                        setTimeout(() => { gkt.$(this).attr("disabled", false); }, 4000)
                        gkt.gktGiftCard.action.onModalBuyNowButton(event)
                    })

                    gkt.$(".gktGiftCardContentFooter").append(gkt.gktGiftCard.state.giftCardAddToCartButtonClone)
                },
                modalNextButton : function(){
                    gkt.$(".gktGiftCardContentFooterBtn1").html(gkt.settings.languageData.giftcard.greetingCardFields.greetingCardContinueButtonText.value || "Next" );
                    gkt.$(".gktGiftCardContentFooterBtn1").css("background-color", "#ffffff");
                    gkt.$(".gktGiftCardContentFooterBtn1").css("color", "#000000");
                    gkt.$(".gktGiftCardContentFooterBtn1").css("border", "1px solid #000000");
                    gkt.$(".gktGiftCardContentFooterBtn1").on("click", function (event) {
                        gkt.$(this).attr("disabled", true);
                        setTimeout(() => { gkt.$(this).attr("disabled", false); }, 4000)
                        
                        gkt.gktGiftCard.action.onModalNextButton(event)
                    })
                },
                
                validateForm: function () {
                    let isValid = true
                    gkt.$(".gktGiftCardInputFieldsDiv input").each(function () {
                        if (gkt.$(this).val() == "") {
                            gkt.$(this).css("border", "1px solid red")
                            isValid = false
                        } else {
                            gkt.$(this).css("border", "1px solid #cccccc")
                        }
                    })
                    gkt.$(".gktGiftCardInputFieldsDiv textarea").each(function () {
                        if (gkt.$(this).val() == "") {
                            gkt.$(this).css("border", "1px solid red")
                            isValid = false
                        } else {
                            gkt.$(this).css("border", "1px solid #cccccc")
                        }
                    })
                    return isValid;
                },
                emailValidation: function (emailString) {
                    var atSymbol = emailString.indexOf("@");
                    if (atSymbol < 1) return false;

                    var dot = emailString.lastIndexOf(".");                    
                    if (dot <= atSymbol + 2) return false;

                    // check that the dot is not at the end
                    if (dot === emailString.length - 1) return false;

                    return true;
                },
                dateValidation : function (date){
                    // if deliveryOption is sendNow then send date should be today
                    if(gkt.gktGiftCard.state.giftCardDeliveryOption == "sendNow"){
                        date = new Date();
                    }
                    let today = new Date().toISOString().slice(0, 10)
                    let dateToCompare = new Date(date).toISOString().slice(0, 10)
                    if (dateToCompare < today) {
                        return false
                    }
                    else if (dateToCompare > new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10)) {
                        return false
                    }
                    else {
                        return true
                    }
                },
            },
            action: {
                giftCardAddToCartButton: async function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    gkt.gktGiftCard.f.openGiftCardModal()

                    console.log("giftCardAddToCartButton-clicked")
                },
                onModalClose: function (e) {
                    // hide the modal
                    gkt.$(".gktGiftCardModalWrapper").hide();
                },
                onModalBack:function(e){
                    gkt.gktGiftCard.action.showGreetingCardBody()
                    gkt.gktGiftCard.action.hideGiftcardDetailsBody()
                },
                removeCheckmarkDivsFromSiblings: function(element){
                    element.siblings().find(".gkt_checkmark").remove()
                    element.siblings().removeClass("activeGreetingCard")             
                },
                addCheckMarkDivs: function (element) {
                    let checkMarkDiv = gkt.$("<span>").addClass("gkt_checkmark")
                    checkMarkDiv.append(gkt.$("<div>").addClass("gkt_checkmark_circle"))
                    checkMarkDiv.append(gkt.$("<div>").addClass("gkt_checkmark_stem"))
                    checkMarkDiv.append(gkt.$("<div>").addClass("gkt_checkmark_kick"))
                    element.append(checkMarkDiv)
                },
                onGreetingCardImageClick : function(image){
                    // Pass either the image or just trigger this as a callback on Onclick
                    let imageSrc;
                    if (false) {
                        imageSrc = image
                        
                    } else {
                        imageSrc = gkt.$(this).find("img").attr("src")
                    }
                      console.log("onclick triggered")
                    // gkt.$('.greetingCardImagePreview').attr("src", imageSrc)
                    gkt.gktGiftCard.state.greetingCardActiveImageSrc = imageSrc

                    gkt.$(this).find("input").prop("checked", true)
                    gkt.$(this).addClass("activeGreetingCard")
                    // add an icon on top of it
                    gkt.gktGiftCard.action.addCheckMarkDivs(gkt.$(this))
                    gkt.gktGiftCard.action.removeCheckmarkDivsFromSiblings(gkt.$(this))

                },
                onGreetingCardCategoryClick : function(){
                    // empty the active state greeting card
                    console.log("onGreetingCardCategoryClick");
                    gkt.$(this).addClass("activeGreetingCardCategory")
                    // remove activeCategory class from other categories
                    gkt.$(this).siblings().removeClass("activeGreetingCardCategory")
                    gkt.gktGiftCard.f.changeGreetingCardImageList(gkt.gktGiftCard.state.greetingCardSelectedCategory);
                },
                onModalBuyNowButton: async function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    let greetingCardSelected = undefined;
                    let categorySelected = "";
                    if(gkt.settings.greetingCards.isGreetingCardEnabled){
                     greetingCardSelected = gkt.gktGiftCard.state.greetingCardActiveImageSrc;
                     categorySelected = gkt.gktGiftCard.state.greetingCardSelectedCategory;
                    }

                    let selectedVariantId = gkt.f.getSelectedVariant()
                    let gkGifttCardFromValue = gkt.$(".gktGiftCardFromInputField").val()
                    let gkGifttCardToValue = gkt.$(".gktGiftCardToInputField").val()
                    let gkGifttCardMessageValue = gkt.$(".gktGiftCardMessageInputField").val()
                    let gkGifttCardEmailValue = gkt.$(".gktGiftCardEmailInputField").val()
                    // if sendNow then set date to today
                    let gkGifttCardDateValue = gkt.$(".gktGiftCardDatePicker").val()
                    // check if deliveryOption is set to sendNow, if yes then reassign date to today
                    if (gkt.gktGiftCard.state.giftCardDeliveryOption == "sendNow") {
                        gkGifttCardDateValue = new Date().toISOString().slice(0, 10);
                    }
                    // let gkGifttCardEmailValueIsValid = gkt.f.validateEmail(gkGifttCardEmailValue)
                    let isFormValid = gkt.gktGiftCard.f.validateForm();
                    let emailValid = gkt.gktGiftCard.f.emailValidation(gkGifttCardEmailValue);
                    let dateValid = gkt.gktGiftCard.f.dateValidation(gkGifttCardDateValue);
                    if (isFormValid && emailValid && dateValid) {
                        gkt.$(".gktGiftCardContentFooterBtn1").html(gkt.settings.languageData.giftcard.purchasePageFields.buyNowButtonTextLoading.value);
                    } else if (!emailValid) {
                        gkt.$(".gktGiftCardEmailValidation").html("Please enter a valid email address")
                        return;
                    }else if (!dateValid){
                        gkt.$(".gktGiftCardDateValidation").html("Cant schedule giftcard more than 30 days from today")
                        return;
                    }
                    else {
                        return;
                    }
                    let clearCart = await gkt.utility.clearCart()
                    let resAddToCart = await gkt.utility.addToCartV2({
                        "items": [
                            {
                                "id": selectedVariantId,
                                "quantity": 1,
                                "properties": {
                                    "To": gkGifttCardToValue,
                                    "From": gkGifttCardFromValue,
                                    "Note": gkGifttCardMessageValue,
                                    "Recipient Email": gkGifttCardEmailValue,
                                    "Delivery Date": gkGifttCardDateValue,
                                    "_Greeting Card Image": greetingCardSelected
                                }
                            }
                        ],
                    })
                    
                    window.location.href = window.location.origin + "/cart/checkout"

                    console.log("onModalBuyNowButton-clicked")
                },

                onModalNextButton: async function (e){
                    e.preventDefault();
                    e.stopPropagation();
                    let greetingCardSelected = gkt.gktGiftCard.state.greetingCardActiveImageSrc;
                    let categorySelected = gkt.gktGiftCard.state.greetingCardSelectedCategory;

                    gkt.gktGiftCard.action.hideGreetingCardBody()
                    gkt.gktGiftCard.action.showGiftcardDetailsBody()
                    // gktGiftCardModalSubText.append(gkt.$("<span>").addClass('gktGiftCardModalSubTextBack').text("Back").on("click", gkt.gktGiftCard.action.onModalBack()))                      

                    gkt.gktGiftCard.f.modalBuyNowButton();
                },
                hideGreetingCardBody: function () {
                    gkt.$(".gktGiftCardGreetingCardContent").hide();

                },
                showGreetingCardBody: function () {
                    gkt.$(".gktGiftCardGreetingCardContent").show();
                },
                showGiftcardDetailsBody: function () {
                    gkt.$(".gktGiftCardDetailsContent").show();
                },
                hideGiftcardDetailsBody: function () {
                    gkt.$(".gktGiftCardDetailsContent").hide();
                },
            },
         },
        gktMessage:{
            init: function (settings, parent) {
                gkt.gktMessage.initialize(settings, parent)
            },
            initialize: function (settings, parent) {
                let productHandle = gkt.f.getProductPageHandle(settings)
                let {isEnabledOnProductPage, isEnabledOnCartPage} = gkt.gktMessage.f.checkifGiftMessageEnabled(settings.giftMessage, productHandle, parent)

                if (parent == "PRODUCT_PAGE" && isEnabledOnProductPage){
                    // let oneClickUpsellProductPageHTML = gkt.gktOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnProductPage, parent)
                    let giftMessageProductPageHTML = gkt.gktMessage.f.prepareUI(settings, productHandle, parent)
                    gkt.gktMessage.f.insertIntoProductPageWrapper(settings, giftMessageProductPageHTML)
                    gkt.utility.overWriteBuyNowBtn()
                    gkt.state.isOverWriteBuyNowBtnTriggered = true
                }

                if (parent == "CART_PAGE" && isEnabledOnCartPage && productHandle == "undefined"){
                    let giftMessageCartPageHTML = gkt.gktMessage.f.prepareUI(settings, productHandle, parent)
                    gkt.gktMessage.f.insertIntoCartPageWrapper(settings, giftMessageCartPageHTML)
                }

                
            },
            f: {
                checkifGiftMessageEnabled: function (giftMessage, currProductHandle, parent) {
                    let isEnabledOnProductPage = false
                    let isEnabledOnCartPage = false

                    if(!giftMessage.isGiftMessageEnabled){
                        return {isEnabledOnProductPage, isEnabledOnCartPage}
                    }

                    if (giftMessage.isVisibleOnCart) {
                        isEnabledOnCartPage = true
                    }

                    if (giftMessage.isVisibleOnAllProductPages) {
                        isEnabledOnProductPage = true
                    } else if (giftMessage.isVisibleOnSpecificProductPages &&
                            giftMessage.visibleOnSpecificProductPages &&
                            giftMessage.visibleOnSpecificProductPages.find(x => x.handle === currProductHandle)) {

                        isEnabledOnProductPage = true
                    }

                    return {isEnabledOnProductPage, isEnabledOnCartPage}
                },
                prepareUI:  function(settings, currProductHandle, parent){
                    let gktGiftMessageContainer = gkt.$("<div>").addClass('gktGiftMessageContainer')

                    let gktGiftMessageItemContainer = gkt.$("<div>").addClass('gktGiftMessageItemContainer')
                    let gktGiftMessageTextArea = gkt.$("<textarea>").addClass('gktGiftMessageTextArea')
                                                                    .attr("placeholder", settings.languageData.giftMessage.giftMessagePlaceholderText)
                                                                    

                    let gktGiftMessageItemContainerCheckboxLable = gkt.$("<label>").addClass('gktCustomCheckboxMsgContainer')
                    let inputCheckboxEle = gkt.$("<input>").addClass('gktGiftMessageInputCheckboxEle')
                        .attr("type", "checkbox")

                    if (gkt.utility.getNoteFromCart()) {
                        inputCheckboxEle.attr("checked", true)
                        let noteVal = gkt.utility.getNoteFromCart()
                        gktGiftMessageTextArea.val(noteVal)
                        // gktGiftMessageTextArea.css("display", "block")
                    }

                    // setTimeout(function () {
                    //     let gktGiftMessageTextAreaEle = gkt.$(".gktGiftMessageTextArea")
                    //     if (gkt.utility.getNoteFromCart() && gktGiftMessageTextAreaEle.val() == "") {
                    //         let noteVal = gkt.utility.getNoteFromCart()
                    //         gktGiftMessageTextAreaEle.val(noteVal)
                    //     }
                    //     console.log("gktGiftMessageTextArea- setimteout")
                    // }, 2000)
                    
                    
                    gktGiftMessageItemContainerCheckboxLable.append(inputCheckboxEle)
                    gktGiftMessageItemContainerCheckboxLable.append(gkt.$("<span>").addClass("gktCustomMsgCheckboxCheckmark"))


                    //create a div with appendString 
                    let gktGiftMessageItemContainerLableText = gkt.$("<div>").addClass('gktGiftMessageItemContainerLabelText')
                                                                .html(settings.languageData.giftMessage.giftMessageHeadingLabel)
                    gktGiftMessageItemContainerCheckboxLable.append(gktGiftMessageItemContainerLableText)
                    gktGiftMessageItemContainer.append(gktGiftMessageItemContainerCheckboxLable)
                    gktGiftMessageContainer.append(gktGiftMessageItemContainer)


                    
                    gktGiftMessageContainer.append(gktGiftMessageTextArea)

                    gkt.$(document).on("click", ".gktGiftMessageInputCheckboxEle",async (e)=>{
                        // window.eventCick = e
                        // let isChecked = gkt.$(e.currentTarget).find(".gktGiftMessageInputCheckboxEle").is(":checked")
                        // if(gkt.$(this).prop('checked') == true){
                        //     console.log("gktCustomCheckboxMsgContainer")
                        // }
                        if(!e.currentTarget.checked){
                            let updateCartData = {  }
                            updateCartData.note = null
                            updateCartData.attributes = {"gktGiftMessage": ""}
                            await gkt.utility.updateCart(updateCartData)
                            // if(gkt.$(".gktGiftMessageTextArea")){
                            //     gkt.$(".gktGiftMessageTextArea").val("")
                            // } 
                            
                        }else{
                            // if(gkt.$(".gktGiftMessageTextArea")){
                            //     let updateCartData = {  }
                            //     updateCartData.note = gkt.$(".gktGiftMessageTextArea").val()
                            //     await gkt.utility.updateCart(updateCartData)
                            // } 
                        }
                        gkt.$(document).find('.gktGiftMessageTextArea').css("display", "block")
                    })

                    gkt.$(document).on("keyup ", ".gktGiftMessageTextArea", ((event)=>{gkt.gktMessage.action.onGiftMessageTextAreakeyup(event,settings, parent)}))
                    
                    return gktGiftMessageContainer    
                },
                insertIntoProductPageWrapper: function (settings, giftMessageHTML) {

                    gkt.elements.productPageWrapperV2.find(".gktGiftMessageWrapper").css("display", "block")

                    // // insert into parent element 
                    // gkt.elements.gktGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEle").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    gkt.elements.productPageWrapperV2.find(".gktGiftMessageWrapper").append(giftMessageHTML);

                },
                insertIntoCartPageWrapper: function (settings, giftMessageHTML) {

                    gkt.elements.cartPageWrapperV2.find(".gktCartGiftMessageWrapper").css("display", "block")

                    // insert into parent element 
                    // gkt.elements.gktCartGiftMsgAndWrapWrapperParent.find(".gktGiftMsgAndWrapWrapperInnerEle").append(settings.giftingOptions.shopifyPageinnerHTML);    //cartPageText                 

                    // insert final  element into productPageWrapperV2
                    // gkt.elements.cartPageWrapperV2.find(".gktCartUpsellWrapper").append(gkt.elements.gktCartGiftMsgAndWrapWrapperParent);
                    gkt.elements.cartPageWrapperV2.find(".gktCartGiftMessageWrapper").append(giftMessageHTML);

                },
            },
            action: {
                onGiftMessageTextAreakeyup: function (event,settings, parent){
                        let giftMessageValue = event.target.value
                        let updateCartData = {  }
                        updateCartData.note = giftMessageValue
                        updateCartData.attributes = {"gktGiftMessage": giftMessageValue}
                        if(gkt.state.timer){
                          clearTimeout(gkt.state.timer);
                          gkt.state.timer  = undefined
                        }
                        
                        gkt.state.timer = setTimeout(()=>{
                                           gkt.utility.updateCart(updateCartData).then((data) => {
                         									console.log("gift message updated")
                        								})
                                           },1000)

                        // gkt.utility.updateCart(updateCartData).then((data) => {
                        // //    console.log("gift message updated")
                        // })
                }
            }
        },
        gktVideoMsg: {
            init: function (settings, parent) {
                gkt.gktVideoMsg.initialize(settings, parent)
            },
            initialize: function (settings, parent) {
                let productHandle = gkt.f.getProductPageHandle(settings)
                let isVideoMsgEnabled = true

                if(isVideoMsgEnabled){
                    // // let oneClickUpsellProductPageHTML = gkt.gktOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnProductPage, parent)
                    // let giftMessageProductPageHTML = gkt.gktMessage.f.prepareUI(settings, productHandle, parent)
                    // gkt.gktMessage.f.insertIntoProductPageWrapper(settings, giftMessageProductPageHTML)
                    // gkt.utility.overWriteBuyNowBtn()
                    // gkt.state.isOverWriteBuyNowBtnTriggered = true
                }

            },
        },
        gktFreeGiftCardPopup:{
            init:function(settings,parent){
                gkt.gktFreeGiftCardPopup.initialize(settings,parent)
            },
            state:{
                gktFreeGiftcardName:null,
                gktFreeGiftcardEmail:null,
                gktFreeGiftcardMessage:null,
            },
            initialize: async function(settings,parent){
                // let productHandle = gkt.f.getProductPageHandle(settings)
                // gkt.gktFreeGiftCardPopup.f.showGiftCard(settings,parent)


            },
            f:{
                showGiftCard: async function(settings,parent){

                    // let isFreeGiftcardPopupEnabled = true

                    // if (parent == "CART_PAGE") {
                        let cartData = await gkt.utility.getCart()
                        
                        let gktFreeGiftcardAlreadyPresent = (cartData.attributes.gktFreeGiftcard == "yes")
                        if(gktFreeGiftcardAlreadyPresent){
                            const freeGiftcardPopupLanguage = gkt.settings.languageData.freeGiftcardPopup
                            gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardName = cartData.attributes.gktFreeGiftcardName
                            gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardEmail = cartData.attributes.gktFreeGiftcardEmail
                            gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardMessage = cartData.attributes.gktFreeGiftcardMessage
                            let clickHereToEditEle = gkt.$("<div>").addClass("gktFreeGiftcardClickHereToEdit")
                            clickHereToEditEle.css("cursor","pointer")
                            clickHereToEditEle.html(freeGiftcardPopupLanguage?.freeGiftCardDetailsAreadySavedSubHeading?.value)
                            
                           let  gktNotificationItem  =  gkt.gktNotification.f.addNotificationItemType1(freeGiftcardPopupLanguage?.freeGiftCardDetailsAreadySavedHeading?.value, clickHereToEditEle, 500)

                            clickHereToEditEle.on("click", ()=>{ 
                                gkt.gktFreeGiftCardPopup.f.prepareUI()
                                gkt.gktFreeGiftCardPopup.f.loadConfirmationPageHtml()
                                if(gktNotificationItem){
                                    gktNotificationItem.css("transform","translateX(300px)")
                                    setTimeout(()=>{gktNotificationItem.remove()},1000)
                                }
                            })

                            
                            
                        }else{
                            gkt.gktFreeGiftCardPopup.f.prepareUI()
                            gkt.gktFreeGiftCardPopup.f.loadConfirmationPageHtml()
                        }
                        gkt.gktFreeGiftCardPopup.f.registerEvents();
                    // }
                    
                },
                prepareUI: function (){

                        // getCartData, check if gktFreeGiftcard is in the attributes
                    
                        let freeGiftcardPopupHTML = gkt.$(".gktFreeGiftcardPopupModal").css("display", "block")
                        gkt.$(".gktFreeGiftcardPopupModalWrapper").css("display", "block")
                        let freeGiftcardPopupModalBodyHTML = gkt.$("<div>").addClass("gktFreeGiftcardPopupModalBody")

       
                        // add a header, an image, 3 fields and a button in the popup
                        const freeGiftcardPopupLanguage = gkt.settings.languageData.freeGiftcardPopup
                        let gktFreeGiftcardPopupModalClose = gkt.$("<div>").addClass("gktFreeGiftcardPopupModalClose").append('<svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></div>')
                        let freeGiftcardPopupHeading = gkt.$("<h3>").addClass("gktFreeGiftcardPopupHeading").html(freeGiftcardPopupLanguage.freeGiftcardPopupHeading.value)
                        let freeGiftcardPopupImage = gkt.$("<img>").addClass("gktFreeGiftcardPopupImage").attr("src", gkt.settings.freeGiftcardPopup.greetingcardImage)

                        // 2 input fields, one of them is for email and the other is for name
                        let freeGiftcardPopupInputFields = gkt.$("<div>").addClass("gktFreeGiftcardPopupInputFields")
                        let freeGiftcardPopupInputFieldsEmail = gkt.$("<input>").addClass("gktFreeGiftcardPopupInputFieldsEmail")
                                                                                .attr("type", "email")
                                                                                .attr("placeholder", freeGiftcardPopupLanguage.emailPlaceholder.value)
                                                                                .attr("value", gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardEmail)
                        let freeGiftcardPopupInputFieldsName = gkt.$("<input>").addClass("gktFreeGiftcardPopupInputFieldsName")
                                                                                .attr("type", "text")
                                                                                .attr("placeholder", freeGiftcardPopupLanguage.namePlaceholder.value)
                                                                                .attr("value", gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardName)
                        let freeGiftcardPopupTextArea = gkt.$("<textarea>").addClass("gktFreeGiftcardPopupTextArea")
                                                                            .attr("placeholder", freeGiftcardPopupLanguage.notePlaceholder.value)
                                                                            .html(gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardMessage)
                        let freeGiftcardPopupButton = gkt.$("<button>").addClass("gktFreeGiftcardPopupButton").html(freeGiftcardPopupLanguage.saveDetails.value)
                        
                        freeGiftcardPopupButton.css("color", "#ffffff");
                        freeGiftcardPopupButton.css("background-color", "#000000");
                        freeGiftcardPopupButton.css("border", "1px solid #000000");
                        freeGiftcardPopupButton.on("click", function (event) {
                            // gkt.$(this).attr("disabled", true);
                            // setTimeout(() => { gkt.$(this).attr("disabled", false); }, 1000)
                            gkt.gktFreeGiftCardPopup.action.onModalSave(freeGiftcardPopupButton)
                        })
                        
                        freeGiftcardPopupInputFields.append(freeGiftcardPopupInputFieldsEmail)
                        freeGiftcardPopupInputFields.append(freeGiftcardPopupInputFieldsName)
                        freeGiftcardPopupInputFields.append(freeGiftcardPopupTextArea)

                        freeGiftcardPopupModalBodyHTML.append(gktFreeGiftcardPopupModalClose)
                        freeGiftcardPopupModalBodyHTML.append(freeGiftcardPopupHeading)
                        freeGiftcardPopupModalBodyHTML.append(freeGiftcardPopupImage)
                        freeGiftcardPopupModalBodyHTML.append(freeGiftcardPopupInputFields)
                        freeGiftcardPopupModalBodyHTML.append(freeGiftcardPopupButton)   



                    return freeGiftcardPopupHTML.html(freeGiftcardPopupModalBodyHTML);                  
                },
                registerEvents: function(){
                    gkt.$(document).on("click", ".gktFreeGiftcardPopupModalClose", gkt.gktFreeGiftCardPopup.action.onModalClose)
                },
                showConfirmationPage(){
                    gkt.$(".gktFreeGiftcardPopupConfirmationPage").css("display", "block")
                    gkt.$(".gktFreeGiftcardPopupModalBody").css("display", "none")
                },
                loadConfirmationPageHtml(){

                    let freeGiftcardPopupHTML = gkt.$(".gktFreeGiftcardPopupModal")
                    let freeGiftcardPopupConfirmationPage = gkt.$("<div>").addClass("gktFreeGiftcardPopupConfirmationPage").css("display", "none")
                    //TODO image
                    let freeGiftcardPopupConfirmationPageImage = gkt.$("<img>").addClass("gktFreeGiftcardPopupConfirmationPageImage").attr("src", "https://giftkart-staging.s3.us-east-2.amazonaws.com/public/checkbox+scalledup.png")
                    //TODO your details have been saved-image
                    let freeGiftcardPopupConfirmationPageHeading = gkt.$("<h3>").addClass("gktFreeGiftcardPopupConfirmationPageHeading").html("Your data has been saved"||gkt.settings.languageData.freeGiftcardPopup.confirmationPageHeading.value);
                    // description of the gift card
                
                    let freeGiftcardPopupConfirmationPageDescription = gkt.$("<p>").addClass("gktFreeGiftcardPopupConfirmationPageDescription")
                                                                          .html(gkt.settings.languageData.freeGiftcardPopup.confirmationPageDescription.value)
                    // show two buttons, one to continue shopping and the other to checkout
                    let freeGiftcardPopupConfirmationPageButtons = gkt.$("<div>").addClass("gktFreeGiftcardPopupConfirmationPageButtons")
                    // TODO Text for the buttons
                    let continueShoppingButton = gkt.$("<button>").addClass("gktFreeGiftcardPopupContinueShoppingButton").html(gkt.settings.languageData.freeGiftcardPopup.continueShoppingButtonText.value)
                    let checkoutButton = gkt.$("<button>").addClass("gktFreeGiftcardPopupCheckoutButton").html(gkt.settings.languageData.freeGiftcardPopup.checkoutButtonText.value)
                    continueShoppingButton.on("click", function (event) {
                        gkt.gktFreeGiftCardPopup.action.onModalClose()
                    })
                    checkoutButton.on("click", function (event) {
                            gkt.$(this).attr("disabled", true);
                            checkoutButton.html(gkt.settings.languageData.freeGiftcardPopup.loadingCheckoutButtonText.value)
                            setTimeout(() => { gkt.$(this).attr("disabled", false); }, 4000)
                            gkt.gktFreeGiftCardPopup.action.onModalCheckout()
                        })

                    freeGiftcardPopupConfirmationPageButtons.append(continueShoppingButton)
                    freeGiftcardPopupConfirmationPageButtons.append(checkoutButton)
                    
                    freeGiftcardPopupConfirmationPage.append(freeGiftcardPopupConfirmationPageDescription)
                    freeGiftcardPopupConfirmationPage.append(freeGiftcardPopupConfirmationPageImage)
                    // freeGiftcardPopupConfirmationPage.append(freeGiftcardPopupConfirmationPageHeading)
                    freeGiftcardPopupConfirmationPage.append(freeGiftcardPopupConfirmationPageButtons)

                    freeGiftcardPopupHTML.append(freeGiftcardPopupConfirmationPage)

                }
            },
            action:{
                onModalClose: function(){
                    gkt.$(".gktFreeGiftcardPopupModalWrapper").css("display", "none")
                },
                showModal: function(){
                    gkt.$(".gktFreeGiftcardPopupModalWrapper").css("display", "block")
                },
                onModalSave: async function(element){
                    // let 
                    let isValidEmail = gkt.utility.emailValidation(gkt.$(".gktFreeGiftcardPopupInputFieldsEmail").val())
                    let isNamePresent = gkt.$(".gktFreeGiftcardPopupInputFieldsName").val().trim() != ""

                    if(isValidEmail && gkt.$(".gktFreeGiftcardPopupInputFieldsEmailError").length > 0){
                            gkt.$(".gktFreeGiftcardPopupInputFieldsEmailError").remove()
                    }

                    if(isNamePresent){
                        gkt.$(".gktFreeGiftcardPopupInputFieldsName").css("border", "1px solid #000000");
                    }

                    if(isValidEmail && isNamePresent){
                        element.off("click")
                        gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardName = gkt.$(".gktFreeGiftcardPopupInputFieldsName").val()
                        gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardEmail = gkt.$(".gktFreeGiftcardPopupInputFieldsEmail").val()
                        gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardMessage = gkt.$(".gktFreeGiftcardPopupTextArea").val()

                        let updateCartData = {  }
                        updateCartData.attributes = {
                            "gktFreeGiftcard": "yes",
                            "gktFreeGiftcardEmail":gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardEmail,
                            "gktFreeGiftcardName": gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardName, 
                            "gktFreeGiftcardMessage":gkt.gktFreeGiftCardPopup.state.gktFreeGiftcardMessage 
                         }
                        await gkt.utility.updateCart(updateCartData)

                        // disable all the input children states present in gktFreeGiftcardPopupInputFields
                        gkt.$(".gktFreeGiftcardPopupInputFields").children().attr("disabled", true)
                        // remove border  from all the children
                        gkt.$(".gktFreeGiftcardPopupInputFields").children().css("border", "none")

                        gkt.gktFreeGiftCardPopup.f.showConfirmationPage();
                        
                    }
                    else if(!isValidEmail){
                        gkt.$(".gktFreeGiftcardPopupInputFieldsEmail").css("border", "1px solid red")
                        // add a small span after it
                        let emailErrorSpan = gkt.$("<span>").addClass("gktFreeGiftcardPopupInputFieldsEmailError").html(gkt.settings.languageData.freeGiftcardPopup.emailErrorText.value)
                        gkt.$(".gktFreeGiftcardPopupInputFieldsEmail").after(emailErrorSpan)
                    }
                    else if(!isNamePresent){
                        gkt.$(".gktFreeGiftcardPopupInputFieldsName").css("border", "1px solid red")
                    }
                },
                onModalCheckout: function(){
                    setTimeout(()=>{
                            window.location.href = window.location.origin + "/cart/checkout"
                        },1000)
                },
            }
        },
        gktNotification:{
            init: function(){
                gkt.gktNotification.initialize()
            },
            state: {
                gktNotification: null,
                gktNotificationType: null,
                gktNotificationMessage: null,
                gktNotificationDuration: null,
                gktNotificationPosition: null,
            },
            initialize: function(){
                gkt.gktNotification.f.addNotificationWrapperToDOM()

                // notification examples
                // gkt.gktNotification.f.addNotificationItemType1("addNotificationItem-1","If your cart value is greater than 40$ you will get 10$ Free Gift Card.", 100)
                // gkt.gktNotification.f.addNotificationItemType1("addNotificationItem-2", "mayy")
                // gkt.gktNotification.f.addNotificationItemType1("addNotificationItem-3")
              
            },
            f: {
                addNotificationWrapperToDOM: function(){
                    if(gkt.$('.gktNotificationWrapper').length == 0){
                        let gktNotificationWrapper = gkt.$("<div>").addClass("gktNotificationWrapper")
                        gkt.$("body").append(gktNotificationWrapper)
                    }
                },

                addNotificationItemType1: function(itemHeading="",itemHeadingSubText="", closeAfterSec=10){
                    if(itemHeading == "" && itemHeadingSubText == "" ){
                        return
                    }
                    let gktNotificationWrapper = gkt.$(".gktNotificationWrapper")
                    let gktNotificationItem = gkt.$("<div>").addClass("gktNotificationItem")
                    let gktNotificationItemContent2 = gkt.$("<div>").addClass("gktNotificationItemContent2").html('<svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 32 32" width="24px" height="24px"><path d="M 16 3 C 8.832031 3 3 8.832031 3 16 C 3 23.167969 8.832031 29 16 29 C 23.167969 29 29 23.167969 29 16 C 29 8.832031 23.167969 3 16 3 Z M 16 5 C 22.085938 5 27 9.914063 27 16 C 27 22.085938 22.085938 27 16 27 C 9.914063 27 5 22.085938 5 16 C 5 9.914063 9.914063 5 16 5 Z M 15 10 L 15 12 L 17 12 L 17 10 Z M 15 14 L 15 22 L 17 22 L 17 14 Z"/></svg>')
                    let gktNotificationItemContent3 = gkt.$("<div>").addClass("gktNotificationItemContent3")
                    let gktNotificationItemContent3Heading = gkt.$("<div>").addClass("gktNotificationItemContent3Heading").html(itemHeading)
                    let gktNotificationItemContent3SubText = gkt.$("<div>").addClass("gktNotificationItemContent3SubText").html(itemHeadingSubText)
                    gktNotificationItemContent3.append(gktNotificationItemContent3Heading)
                    gktNotificationItemContent3.append(gktNotificationItemContent3SubText)
                    let gktNotificationItemContent4 = gkt.$("<div>").addClass("gktNotificationItemContent4").html('<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="12px" height="12px" viewBox="0 0 122.878 122.88" enable-background="new 0 0 122.878 122.88" xml:space="preserve"><g><path fill=#575050 d="M1.426,8.313c-1.901-1.901-1.901-4.984,0-6.886c1.901-1.902,4.984-1.902,6.886,0l53.127,53.127l53.127-53.127 c1.901-1.902,4.984-1.902,6.887,0c1.901,1.901,1.901,4.985,0,6.886L68.324,61.439l53.128,53.128c1.901,1.901,1.901,4.984,0,6.886 c-1.902,1.902-4.985,1.902-6.887,0L61.438,68.326L8.312,121.453c-1.901,1.902-4.984,1.902-6.886,0 c-1.901-1.901-1.901-4.984,0-6.886l53.127-53.128L1.426,8.313L1.426,8.313z"/></g></svg>')
                    gktNotificationItemContent4.on("click", function (event) {
                        gktNotificationItem.css("transform","translateX(300px)")
                        setTimeout(()=>{gktNotificationItem.remove()},1000)
                    })
                    
                    setTimeout(function(){
                        console.log("gktNotificationItem", gktNotificationItem)
                        if(gktNotificationItem){
                            gktNotificationItem.css("transform","translateX(300px)")
                            setTimeout(()=>{gktNotificationItem.remove()},1000)
                        }
                    },closeAfterSec*1000)
                    
                    gktNotificationItem.append(gktNotificationItemContent2)
                    gktNotificationItem.append(gktNotificationItemContent3)
                    gktNotificationItem.append(gktNotificationItemContent4)
                    
                    gktNotificationWrapper.css("display", "block")
                    gktNotificationWrapper.append(gktNotificationItem)

                    //slide in the notification
                    setTimeout(()=>{
                        gktNotificationItem.css("transform","translateX(0px)")
                    },100)

                    return gktNotificationItem
                },
                removeNotificationFromDOM: function(){
                    setTimeout(()=>{
                        gkt.$(".gktNotification").remove()
                    }, gkt.gktNotification.state.gktNotificationDuration)
                }
            }
        } 
    
    }

    window.gkt = gkt;
    /*
    * start the program 
    */
    gktUtils.f.loadJquery(function (jqueryRefObj) {
        gkt.$ = jqueryRefObj;

        gkt.$(document).ready(function () {
            console.log("document ready", gkt.$);
            gkt.f.initialize(gkt.$);
        })
    })

</script>
